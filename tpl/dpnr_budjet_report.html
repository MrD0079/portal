<h1>Бюджеты ДПНР (сводный отчет)</h1>

{if not $smarty.request.print}

<form target="_self" method="POST" name=form1 id=form1>
<table style="text-align: left;" border=0>
<tbody>
<tr>
<td>Рынок</td>
<td>
			{foreach key=key item=item from=$markets}
				<input name=markets[{$item.id}] id=cb_{$item.id} type=checkbox>{$item.name}
			{/foreach}
			<script>
			{if $smarty.request.markets}
				{foreach key=key item=item from=$smarty.request.markets}
					$("#cb_{$key}").attr('checked',true);
				{/foreach}
			{else}
				{foreach key=key item=item from=$markets}
					$("#cb_{$item.id}").attr('checked',true);
				{/foreach}
			{/if}
			</script>
</td>
</tr>
<tr>
<td>Период</td>
<td>
			<select name=sd id=sd>
			{foreach key=key item=item from=$month_list}
				<option value="{$item.sd_c}">{$item.my}</option>
			{/foreach}
			</select>

			<select name=ed id=ed>
			{foreach key=key item=item from=$month_list}
				<option value="{$item.sd_c}">{$item.my}</option>
			{/foreach}
			</select>

			<script>$("#sd option[value='{$smarty.request.sd}']").prop('selected', true);</script>
			<script>$("#ed option[value='{$smarty.request.ed}']").prop('selected', true);</script>
</td>
</tr>
<tr>
<td>Менеджер</td>
<td>
			<select name=dpnr id=dpnr>
				<option value=0></option>
				{foreach key=key item=item from=$m_tn_list}
				<option value={$item.tn}>{$item.fio} - {$item.dpt_name}</option>
				{/foreach}
			</select>

			<script>$('#dpnr option[value={$smarty.request.dpnr}]').prop('selected', true);</script>
</td>
</tr>
<tr>
	<td>
	</td>
	<td>
	<input type=radio id="ok_chief" name="ok_chief" value=1>все
	<input type=radio id="ok_chief" name="ok_chief" value=2>подтверждено руководителем
	<input type=radio id="ok_chief" name="ok_chief" value=3>не подтверждено руководителем
	<script>$("input[name=ok_chief][value={$smarty.request.ok_chief}]").attr('checked',true);</script>
	</td>
</tr>
<tr>
	<td>
	</td>
	<td>
	<input type=radio id="pf" name="pf" value=1>все
	<input type=radio id="pf" name="pf" value=2>план
	<input type=radio id="pf" name="pf" value=3>факт
	<script>$("input[name=pf][value={$smarty.request.pf}]").attr('checked',true);</script>
	</td>
</tr>
</tbody>
</table>
<p><input name="generate" value="Построить отчет" type="submit"><p>

{/if}

{if $smarty.request.generate}

<h3>Объем реализации и затраты</h3>

<table style="text-align: left;" border=0>
<tbody>
<tr>
<td style="font-weight:bold">Тонны</td>
{if $smarty.request.pf neq 3}<td>План:{$head.plan_weight|num:2}</td>{/if}
{if $smarty.request.pf neq 2}<td>Факт:{$head.fakt_weight|num:2}</td>   {/if}
<td colspan="1" rowspan="1" style="  background-color: rgb(204, 255, 255); font-weight: bold;">Затраты на продвижение, %:</td>
</tr>
<tr>
<td style="font-weight:bold">$</td>
{if $smarty.request.pf neq 3}<td>План:{$head.plan_sum|num:2}</td>{/if}
{if $smarty.request.pf neq 2}<td>Факт:{$head.fakt_sum|num:2}</td>   {/if}
<td style="  background-color: rgb(204, 255, 255); font-weight: bold;">
{if $smarty.request.pf neq 3}<b>План:</b>{$body.zat_plan|num:2}{/if}
{if $smarty.request.pf neq 2}<b>Факт:</b>{$body.zat_fakt|num:2}{/if}
</td>
</tr>
<tr>
<td style="font-weight:bold">Евро</td>
{if $smarty.request.pf neq 3}<td>План:{$head.plan_sume|num:2}</td>{/if}
{if $smarty.request.pf neq 2}<td>Факт:{$head.fakt_sume|num:2}</td>   {/if}
<td style="  background-color: rgb(204, 255, 255); font-weight: bold;">
{if $smarty.request.pf neq 3}<b>План:</b>{$body.zat_plane|num:2}{/if}
{if $smarty.request.pf neq 2}<b>Факт:</b>{$body.zat_fakte|num:2}{/if}
</td>
</tr>
</tbody>
</table>

{if not $smarty.request.print}
<p><a href="?action=dpnr_budjet_report&print=1&excel=1&generate=1&filename=Бюджеты ДПНР (сводный отчет)">Экспорт в Excel</a></p>
{/if}

<table style="text-align: left;" border=1>
<tbody>
<tr style="text-align:center; font-weight: bold;">
	<td></td>
	{foreach key=kc item=ic from=$body.columns}
	{if $smarty.request.pf neq 3}<td>План</td>{/if}
	{if $smarty.request.pf neq 2}<td>Факт</td>{/if}
	<td>Коммент</td>
	{/foreach}
	{if $smarty.request.pf neq 3}<td style="background-color:lightgreen">План</td>{/if}
	{if $smarty.request.pf neq 2}<td style="background-color:lightgreen">Факт</td>{/if}
</tr>
{foreach key=k item=i from=$body.data}
<tr style="font-weight: bold;">
	<td></td>
	{foreach key=kc item=ic from=$body.columns}
	<td colspan="{if $smarty.request.pf eq 1}3{else}2{/if}">{$ic}</td>
	{/foreach}
	<td colspan=2 style="background-color:lightgreen;text-align:center">ИТОГО</td>
</tr>
<tr>
	<td style="  background-color: rgb(204, 204, 204); font-weight: bold;">{$i.spname}</td>
	{foreach key=k1 item=i1 from=$i.columns}
	{if $smarty.request.pf neq 3}<td style="  background-color: rgb(204, 204, 204); text-align:right;">{$i1.plan|num:2}</td>{/if}
	{if $smarty.request.pf neq 2}<td style="  background-color: rgb(204, 204, 204); text-align:right;">{$i1.fakt|num:2}</td>{/if}
	<td style="  background-color: rgb(204, 204, 204);"></td>
	{/foreach}
	{if $smarty.request.pf neq 3}<td style="  background-color: rgb(204, 204, 204); text-align:right; font-weight: bold; background-color:lightgreen">{$i.plan|num:2}</td>{/if}
	{if $smarty.request.pf neq 2}<td style="  background-color: rgb(204, 204, 204); text-align:right; font-weight: bold; background-color:lightgreen">{$i.fakt|num:2}</td>{/if}
</tr>

{foreach key=k1 item=i1 from=$i.data}
{cycle assign=bgcolor values="#ccffff,#ffffcc"}
<tr bgcolor="{$bgcolor}">
	<td>{$i1.scname}</td>
	{foreach key=k2 item=i2 from=$i1.columns}
	{if $smarty.request.pf neq 3}<td style="text-align:right;">{$i2.plan|num:2}</td>{/if}
	{if $smarty.request.pf neq 2}<td style="text-align:right;">{$i2.fakt|num:2}</td>{/if}
	<td>{$i2.comm}</td>
	{/foreach}
	{if $smarty.request.pf neq 3}<td style="text-align:right; font-weight: bold; background-color:lightgreen">{$i1.plan|num:2}</td>{/if}
	{if $smarty.request.pf neq 2}<td style="text-align:right; font-weight: bold; background-color:lightgreen">{$i1.fakt|num:2}</td>{/if}
</tr>
{/foreach}

{/foreach}

<tr style="font-weight: bold; background-color:lightgreen">
	<td colspan="1" rowspan="2">ИТОГО</td>
	{foreach key=k item=i from=$body.total}
	{if $smarty.request.pf neq 3}<td style=" text-align:right;">{$i.plan|num:2}</td>{/if}
	{if $smarty.request.pf neq 2}<td style=" text-align:right;">{$i.fakt|num:2}</td>{/if}
	<td></td>
	{/foreach}
	{if $smarty.request.pf neq 3}<td style="text-align:right;">{$body.plan|num:2}</td>{/if}
	{if $smarty.request.pf neq 2}<td style="text-align:right;">{$body.fakt|num:2}</td>{/if}
</tr>
</tbody>
</table>

{/if}

</form>
