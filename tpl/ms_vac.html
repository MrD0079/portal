<h1>Заявка на отпуск Мерчандайзера</h1>

<p>
РММС
<select id="list_rm" onchange="load_svms()"><option value="0"></select>
СВМС
<select id="list_svms" onchange="load_ms()"><option value="0"></select>
</p>

<table border=1 id="list_ms">
    <tbody>
    <tr style="text-align: center;font-weight:bold;background-color: rgb(204, 255, 255);">
        <td>Мерчандайзер ФИО</td>
        <td width="50px">Дата начала работы</td>
        <td width="50px">текущий стаж, лет/месяцев/дней</td>
        <td width="50px">кол-во доступных дней отпуска</td>
        <td>Отпуска в текущем году</td>
    </tr>
    </tbody>
</table>

<p></p>

<form name=form target=_self method=post id="add_vac">
<table cellspacing=0 cellpadding=3 align=center border=0 width='300px'>
<tr id="{$item.id}">
<td>Мерчандайзер</td>
<td style="text-align: center;">
    <select name="new[login]">
        <option></option>
        {foreach key=key1 item=item1 from=$list_ms}
        <option value="{$item1.login}">{$item1.fio}</option>
        {/foreach}
    </select>
</td>
<td>Дата начала</td>
<td><input size=8 class="datepicker" name="new[vac_start]"></td>
<td>Кол-во дней отпуска</td>
<td style="text-align: center;">
    <select name=new[days]>
        <option value="7">7</option>
        <option value="14">14</option>
    </select>
</td>
<td><input type='button' name="add" value="Добавить" onClick="add_vac();"></td>
</tr>
</table>
</form>

<p><div style='color:red' id="ok"></div></p>

<table border=1 id="list_vac">
    <tbody>
    <tr style="text-align: center;font-weight:bold;background-color: rgb(204, 255, 255);">
        <td>Удалить</td>
        <td>Мерчандайзер ФИО</td>
        <td width="50px">Дата начала работы</td>
        <td width="50px">Использованное кол-во дней отпуска в тек году</td>
        <td>Период отпуска с .. По</td>
        <td>ФИО создавшего заявку на отпуск</td>
        <td width="50px">Дата создания отпуска</td>
    </tr>
</table>

<script>
    {literal}
    $(function(){
        DisabledDates={"period":[{ "from": "01/01/1999", "to": "{/literal}{$yesterdayJS}{literal}"}]};
        $.get(
                '?action=ms_vac&nohead=1&list_rm=1',
                function(data){
                    $('#list_rm').html(data);
                }
            );
        load_svms();
        load_ms();
        load_vac();
    })
    
    function add_vac(){
        $.get(
                '?action=ms_vac&nohead=1&add_vac=1',
                $('#add_vac').serialize(),
                function(data){
                    $('#ok').html(data);
                    load_ms();
                    load_vac();
                }
            );
    }
    
    function load_svms(){
        //console.log($('#list_rm').val());
        $.get(
                '?action=ms_vac&nohead=1&list_svms=1',
                {rm_tn:$('#list_rm').val()},
                function(data){
                    $('#list_svms').html(data);
                }
            );
    }
    
    function load_ms(){
        //console.log($('#list_rm').val()+' '+$('#list_svms').val());
        $.get(
                '?action=ms_vac&nohead=1&list_ms=1',
                {rm_tn:$('#list_rm').val(),svms_tn:$('#list_svms').val()},
                function(data){
                    $("#list_ms").find("tr:gt(0)").remove();
                    $('#list_ms').append(''+data+'');
                }
            );
    }
    
    function load_vac(){
        //console.log($('#list_rm').val()+' '+$('#list_svms').val());
        $.get(
                '?action=ms_vac&nohead=1&list_vac=1',
                function(data){
                    $("#list_vac").find("tr:gt(0)").remove();
                    $('#list_vac').append(''+data+'');
                }
            );
    }
    
    function vacRemove(id){
        $("#vac"+id).css("opacity",0.3);
        $.get(
                '?action=ms_vac&nohead=1&vac_remove=1',
                {id:id},
                function(data){
                    load_ms();
                    load_vac();
                }
            );
    }
    {/literal}
</script>