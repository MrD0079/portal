<h2>Сводный отчет по акции "Весь мир для тебя с АВК"</h2>

{if not $smarty.request.print}

<form target="_self" method="POST" name=form_report id=form_report>

<input type="hidden" name="form_submit">

<p>
<a {if $smarty.request.w4u_report_page eq 'eta'}style="font-weight:bold"{/if} href="?action=w4u_report&ver={$smarty.request.ver}&w4u_report_page=eta&w4u_report_best=17"> ЭТА </a>&nbsp
<a {if $smarty.request.w4u_report_page eq 'ts'} style="font-weight:bold"{/if} href="?action=w4u_report&ver={$smarty.request.ver}&w4u_report_page=ts&w4u_report_best=10"> ТС </a>&nbsp
<a {if $smarty.request.w4u_report_page eq 'tm'} style="font-weight:bold"{/if} href="?action=w4u_report&ver={$smarty.request.ver}&w4u_report_page=tm&w4u_report_best=2"> ТМ </a>&nbsp
<a {if $smarty.request.w4u_report_page eq 'rm'} style="font-weight:bold"{/if} href="?action=w4u_report&ver={$smarty.request.ver}&w4u_report_page=rm&w4u_report_best=1"> РМ </a>&nbsp
</p>

<p>
Определять лидеров по кварталу:&nbsp
{foreach key=key item=item from=$w4u_report_q_list}
<input checked type=radio name='q' id='q' value='{$item.dt}'>{$item.q}й квартал {$item.y}г.&nbsp
{/foreach}
</p>

{foreach key=key item=item from=$w4u_report_q_list}
{if $smarty.request.q eq $item.dt}
<script>$("input[name=q][value={$smarty.request.q}]").attr('checked',true);</script>
{/if}
{/foreach}

<input type=submit name=generate value="Показать">
</form>

{/if}

{if $smarty.request.generate}

{if not $smarty.request.print}
<p><a href="?action=w4u_report&ver={$smarty.request.ver}&w4u_report_page={$smarty.request.w4u_report_page}&print=1&excel=1&filename=Сводный отчет по акции Весь мир для тебя с АВК&generate=1">Экспорт в Excel</a></p>
{else}
<p></p>
{/if}

<table style="text-align: left;" border="1" cellpadding="2" cellspacing="0">
	<tr style="font-weight:bold;text-align:center">
		<td>№ п/п</td>
		<td>Сотрудник</td>
		<td>Руководитель</td>
		{foreach key=k item=i from=$d.cols}
		{foreach key=k1 item=i1 from=$i}
		{foreach key=k2 item=i2 from=$i1}
		<td>{$i2}</td>
		{/foreach}
		<td style="background-color: rgb(255, 204, 153);">{$k1}кв.</td>
		{/foreach}
		<td style="background-color: rgb(255, 153, 204);">{$k}г.</td>
		{/foreach}
	</tr>
	{assign var=cnt value=0}
	{foreach key=k item=i from=$d.cells name=cells}
		{assign var=bad_akb value=0}
		{foreach key=ck item=ci from=$d.cols}
			{foreach key=ck1 item=ci1 from=$ci}
				{foreach key=ck2 item=ci2 from=$ci1}
				{/foreach}
				{if $i.data.$ck.data.$ck1.bad_akb eq 1 and $i.data.$ck.data.$ck1.qd eq $smarty.request.q}
					{assign var=bad_akb value=1}
				{/if}
			{/foreach}
		{/foreach}
		{if $bad_akb neq 1}
		{assign var=cnt value=$cnt+1}
		<tr>
			<td style="text-align:center">{$cnt}</td>
			<td style="text-align:left;{if $cnt <= $smarty.request.w4u_report_best}background-color: rgb(51, 255, 51){/if}">{$k}</td>
			<td style="text-align:left">{$i.head}</td>
			{foreach key=ck item=ci from=$d.cols}
				{foreach key=ck1 item=ci1 from=$ci}
					{foreach key=ck2 item=ci2 from=$ci1}
						<td style="text-align:right;{if $i.data.$ck.data.$ck1.data.$ck2.bad_akb eq 1}background-color:red{/if}"><!--{$ck2}м.-->{$i.data.$ck.data.$ck1.data.$ck2.fact_ball}</td>
					{/foreach}
					<td style="background-color: rgb(255, 204, 153);text-align:right"><!--{$ck1}кв.-->{$i.data.$ck.data.$ck1.fact_ball}</td>
					<!--<td style="background-color: rgb(255, 204, 153);text-align:right">{if $i.data.$ck.data.$ck1.bad_akb eq 1}результат не учитывается{/if}</td>-->
				{/foreach}
				<td style="background-color: rgb(255, 153, 204);text-align:right"><!--{$ck}г.-->{$i.data.$ck.total}</td>
			{/foreach}
		</tr>
		{/if}
	{/foreach}
</table>

<p>Результат не учитывается:</p>

<table style="text-align: left;" border="1" cellpadding="2" cellspacing="0">
	<tr style="font-weight:bold;text-align:center">
		<td>№ п/п</td>
		<td>Сотрудник</td>
		<td>Руководитель</td>
		{foreach key=k item=i from=$d.cols}
		{foreach key=k1 item=i1 from=$i}
		{foreach key=k2 item=i2 from=$i1}
		<td>{$i2}</td>
		{/foreach}
		<td style="background-color: rgb(255, 204, 153);">{$k1}кв.</td>
		<!--<td style="background-color: rgb(255, 204, 153);">комментарий</td>-->
		{/foreach}
		<td style="background-color: rgb(255, 153, 204);">{$k}г.</td>
		{/foreach}
	</tr>
	{assign var=cnt value=0}
	{foreach key=k item=i from=$d.cells name=cells}
		{assign var=bad_akb value=0}
		{foreach key=ck item=ci from=$d.cols}
			{foreach key=ck1 item=ci1 from=$ci}
				{foreach key=ck2 item=ci2 from=$ci1}
				{/foreach}
				{if $i.data.$ck.data.$ck1.bad_akb eq 1 and $i.data.$ck.data.$ck1.qd eq $smarty.request.q}
					{assign var=bad_akb value=1}
				{/if}
			{/foreach}
		{/foreach}
		{if $bad_akb eq 1}
		{assign var=cnt value=$cnt+1}
		<tr>
			<td style="text-align:center">{$cnt}</td>
			<td style="text-align:left;">{$k}</td>
			<td style="text-align:left">{$i.head}</td>
			{foreach key=ck item=ci from=$d.cols}
				{foreach key=ck1 item=ci1 from=$ci}
					{foreach key=ck2 item=ci2 from=$ci1}
						<td style="text-align:right;{if $i.data.$ck.data.$ck1.data.$ck2.bad_akb eq 1}background-color:red{/if}"><!--{$ck2}м.-->{$i.data.$ck.data.$ck1.data.$ck2.fact_ball}</td>
					{/foreach}
					<td style="background-color: rgb(255, 204, 153);text-align:right"><!--{$ck1}кв.-->{$i.data.$ck.data.$ck1.fact_ball}</td>
					<!--<td style="background-color: rgb(255, 204, 153);text-align:right">{if $i.data.$ck.data.$ck1.bad_akb eq 1}результат не учитывается{/if}</td>-->
				{/foreach}
				<td style="background-color: rgb(255, 153, 204);text-align:right"><!--{$ck}г.-->{$i.data.$ck.total}</td>
			{/foreach}
		</tr>
		{/if}
	{/foreach}
</table>

{/if}

