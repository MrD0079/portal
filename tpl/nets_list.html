<h1>Сети</h1>

<p>
<a id=a1 href="?action=nets_list&activ=1">Активные</a>
<a id=a0 href="?action=nets_list&activ=0">Неактивные</a>
<a id=a2 href="?action=nets_list&activ=2">Все</a>
</p>

<script>$('#a{$smarty.request.activ}').css('font-weight','bold');</script>

<form target="_self" method="POST" name=form_nets id=form_nets>

{if not $smarty.request.id_net}
<a href="javascript:void(0)" onclick="javascript:s(0);">Добавить сеть</a>
<br>
{/if}

<table border=1 cellspacing=0 cellpadding=3>
	<tr style="font-weight:bold;">
		{if not $smarty.request.id_net>0}
		<td><a href="javascript:void(0)" onclick="javascript:form_nets.submit()">[x]</a></td>
		<td>ред.</td>
		{/if}
		<td>Название</td>
		<td>Статус</td>
		<td>Ответственный НМ КК</td>
		<td>Ответственный ТМ КК</td>
		<td>Код в SW</td>
		<td align=center>Актив.<br><a href="javascript:void(0)" onclick="javascript:form_nets.submit()">+</a></td>
		<td align=center>Кат. А<br><a href="javascript:void(0)" onclick="javascript:form_nets.submit()">+</a></td>
		<td>Код подразделения 1с</td>
	</tr>
	{foreach key=nets_key item=nets_item from=$nets}


	{if $smarty.request.id_net > 0}
	{if $nets_item.id_net eq $smarty.request.id_net}

	<input type=hidden name=edit_id_net value="{$smarty.request.id_net}">
	<tr>
		<td><input size=30 name=edit[net_name] value="{$nets_item.net_name|escape}"></td>
		<td>
			<!--<input size=3 name=edit[id_status] value="{$nets_item.id_status}">-->
			<select name=edit[id_status] id=edit[id_status]>
				<option></option>
				{foreach key=nets_status_key item=nets_status_item from=$nets_status}
				<option value={$nets_status_item.id}>{$nets_status_item.status_name}</option>
				{/foreach}
			</select>
			<script>document.form_nets["edit[id_status]"].value={$nets_item.id_status};</script>
		</td>
		<td>
			<!--<input size=14 name=edit[tn_rmkk] value="{$nets_item.tn_rmkk}">-->
			<select name=edit[tn_rmkk] id=edit[tn_rmkk]>
				<option></option>
				{foreach key=rmkk_key item=rmkk_item from=$list_rmkk}
				<option value={$rmkk_item.tn}>{$rmkk_item.fio} ({$rmkk_item.tn}) {$rmkk_item.dpt_name}</option>
				{/foreach}
			</select>
			<script>document.form_nets["edit[tn_rmkk]"].value={$nets_item.tn_rmkk};</script>
		</td>
		<td>
			<!--<input size=14 name=edit[tn_mkk] value="{$nets_item.tn_mkk}">-->
			<select name=edit[tn_mkk] id=edit[tn_mkk]>
				<option></option>
				{foreach key=mkk_key item=mkk_item from=$list_mkk}
				<option value={$mkk_item.tn}>{$mkk_item.fio} ({$mkk_item.tn}) {$mkk_item.dpt_name}</option>
				{/foreach}
			</select>
			<script>document.form_nets["edit[tn_mkk]"].value={$nets_item.tn_mkk};</script>
		</td>
		<td><input size=5 name=edit[sw_kod] value="{$nets_item.sw_kod}"></td>
		<td {if $nets_item.activ eq 1}bgcolor="#00ff00"{/if} style="text-align:center">
			<input onclick="$('#activ_changed_{$nets_item.id_net}').val(this.checked?1:0)" type=checkbox {if $nets_item.activ eq 1}checked{/if} name=activ_on[{$nets_item.id_net}] value="{$nets_item.id_net}">
			<input type=hidden name=activ_changed[{$nets_item.id_net}] id=activ_changed_{$nets_item.id_net} value="">
		</td>
		<td {if $nets_item.cat_a eq 1}bgcolor="#00ff00"{/if} style="text-align:center">
			<input onclick="$('#cat_a_changed_{$nets_item.id_net}').val(this.checked?1:0)" type=checkbox {if $nets_item.cat_a eq 1}checked{/if} name=cat_a_on[{$nets_item.id_net}] value="{$nets_item.id_net}">
			<input type=hidden name=cat_a_changed[{$nets_item.id_net}] id=cat_a_changed_{$nets_item.id_net} value="">
		</td>
		<td><input size=15 name=edit[kod1s] value="{$nets_item.kod1s}"></td>
	</tr>
	{/if}
	{else}
	<tr>
		<td><input type=checkbox name=del[] value={$nets_item.id_net}></td>
		<td><a href="javascript:void(0)" onclick="javascript:s({$nets_item.id_net});">ред.</a></td>
		<td>{$nets_item.net_name}</td>
		<td>{$nets_item.status_name}</td>
		<td>{$nets_item.rmkk_name} ({$nets_item.tn_rmkk})</td>
		<td>{$nets_item.mkk_name} ({$nets_item.tn_mkk})</td>
		<td>{$nets_item.sw_kod}</td>
		<td {if $nets_item.activ eq 1}bgcolor="#00ff00"{/if} style="text-align:center">
			<input onclick="$('#activ_changed_{$nets_item.id_net}').val(this.checked?1:0)" type=checkbox {if $nets_item.activ eq 1}checked{/if} name=activ_on[{$nets_item.id_net}] value="{$nets_item.id_net}">
			<input type=hidden name=activ_changed[{$nets_item.id_net}] id=activ_changed_{$nets_item.id_net} value="">
		</td>
		<td {if $nets_item.cat_a eq 1}bgcolor="#00ff00"{/if} style="text-align:center">
			<input onclick="$('#cat_a_changed_{$nets_item.id_net}').val(this.checked?1:0)" type=checkbox {if $nets_item.cat_a eq 1}checked{/if} name=cat_a_on[{$nets_item.id_net}] value="{$nets_item.id_net}">
			<input type=hidden name=cat_a_changed[{$nets_item.id_net}] id=cat_a_changed_{$nets_item.id_net} value="">
		</td>
		<td>{$nets_item.kod1s}</td>
	</tr>
	{/if}
	{/foreach}
</table>
<input type=submit name=save id=save class=save value="Сохранить">
</form>

<br>

<form target="_self" method="POST" name=form_nets_replace id=form_nets_replace>
	<table border=0>
		<tr style="text-align:center; font-weight:bold">
			<td colspan=2>Замена ответственных
			</td>
		</tr>
		<tr style="text-align:center; font-weight:bold">
			<td>НМ КК
			</td>
			<td>ТМ КК
			</td>
		</tr>
		<tr style="text-align:center; font-weight:bold">
			<td>
				<select name=rmkk_from id=rmkk_from>
					<option></option>
					{foreach key=rmkk_key item=rmkk_item from=$list_rmkk}
					<option value={$rmkk_item.tn}>{$rmkk_item.fio} ({$rmkk_item.tn}) {$rmkk_item.dpt_name}</option>
					{/foreach}
				</select>
			</td>
			<td>
				<select name=mkk_from id=mkk_from>
					<option></option>
					{foreach key=mkk_key item=mkk_item from=$list_mkk}
					<option value={$mkk_item.tn}>{$mkk_item.fio} ({$mkk_item.tn}) {$mkk_item.dpt_name}</option>
					{/foreach}
				</select>
			</td>
		</tr>
		<tr style="text-align:center; font-weight:bold">
			<td>на
			</td>
			<td>на
			</td>
		</tr>
		<tr style="text-align:center; font-weight:bold">
			<td>
				<select name=rmkk_to id=rmkk_to>
					<option></option>
					{foreach key=rmkk_key item=rmkk_item from=$list_rmkk}
					<option value={$rmkk_item.tn}>{$rmkk_item.fio} ({$rmkk_item.tn}) {$rmkk_item.dpt_name}</option>
					{/foreach}
				</select>
			</td>
			<td>
				<select name=mkk_to id=mkk_to>
					<option></option>
					{foreach key=mkk_key item=mkk_item from=$list_mkk}
					<option value={$mkk_item.tn}>{$mkk_item.fio} ({$mkk_item.tn}) {$mkk_item.dpt_name}</option>
					{/foreach}
				</select>
			</td>
		</tr>
	</table>
	<input type=submit name=replace id=replace value="Заменить">
</form>




{literal}
<script>
function s(id)
{
	$("#form_nets").append($('<input type=hidden name=id_net id=id_net value='+id+'>'));
	$('#form_nets').submit();
}

</script>
{/literal}
