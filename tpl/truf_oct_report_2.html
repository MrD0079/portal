{if not $smarty.request.print}

<p><input type=submit name=save id=save class=save value="Сохранить"></p>

{if $is_traid}
{literal}
<a href="javascript:void(0);" onclick="$('.chk_all:enabled').each(function(){$(this).prop('checked',false);$(this).click();});">[+]</a>
<a href="javascript:void(0);" onclick="$('.chk_all:enabled').each(function(){$(this).prop('checked',true);$(this).click();});">[-]</a>
{/literal}
{/if}

{/if}

<table border=1 cellspacing=0 cellpadding=3>
	<tr style="font-weight:bold">
		<td>№ п/п</td>
		<td>ФИО руководителя</td>
		<td>ФИО ТС</td>
		<td>ФИО ЭТА</td>
		<td>Название ТП</td>
		<td>Адрес ТП</td>
		<td>Факт сентября, {$valuta}</td>
		<td>Факт октября (без учета накладных по акции "7+1 октябрь" и "4+1 октябрь"), {$valuta}</td>
		<td>Прирост, %</td>
		<td>Прирост, {$valuta}</td>
		<td>Бонус расчетный (20% прироста), {$valuta}</td>


		<td>Имя, телефон ЛПР</td>
		<td>Запрет ВСТМ</td>
		<td>Комментарий ВСТМ</td>

		<td>Бонус выдан, сумма бонуса фактич., {$valuta}</td>
		<td>Выдачу бонуса подтверждаю</td>

	</tr>
	{foreach key=list_key item=list_item from=$list name=list}
	<tr bgcolor="{cycle values="#ccffff,#ffffcc"}">
		<td>{$smarty.foreach.list.iteration}</td>
		<td>{$list_item.parent_fio}</td>
		<td>{$list_item.fio_ts}</td>
		<td>{$list_item.fio_eta}</td>
		<td>{$list_item.tp_kod} {$list_item.tp_ur}</td>
		<td>{$list_item.tp_addr}</td>
		<td style="text-align:right">{$list_item.sales7|default:0|num:2}</td>
		<td style="text-align:right">{$list_item.sales8|default:0|num:2}</td>
		<td style="text-align:right">{$list_item.rost_perc|default:0|num:2}</td>
		<td style="text-align:right">{$list_item.rost_uah|default:0|num:2}</td>
		<td style="text-align:right">{$list_item.bonus_plan|default:0|num:2}</td>
		<td>{$list_item.contact_lpr|escape}</td>
		<td style="text-align:center">
			{if not $smarty.request.print}
			<input
			class="chk_all"
			name="cb_traid[]"
			type=checkbox
			onclick="javascript:check_item('ok2',{$list_item.tp_kod},'ok_traid',this.checked)"
			{if $list_item.ok_traid eq 1}checked{/if}
			{if not $is_traid or $list_item.ok_ts eq 1 or $list_item.ok_chief eq 1}disabled{/if}
			>
			{if $list_item.ok_traid eq 1}да{/if}{if $list_item.ok_traid eq '0'}нет{/if}
			<input type=hidden name=ok2[ok_traid][{$list_item.tp_kod}]>
			{else}
				{if $list_item.ok_traid eq 1}да{/if}
			{/if}
		</td>
		<td style="text-align:center">
			{if not $smarty.request.print}
			<input name=text2[text_traid][{$list_item.tp_kod}]
			{if not $is_traid eq 1 or $list_item.ok_ts eq 1 or $list_item.ok_chief eq 1}disabled{/if}
			value="{$list_item.text_traid}"
			>
			{else}
				{$list_item.text_traid}
			{/if}
		</td>
		<td {if $list_item.ok_ts eq 1}bgcolor="#00ff00"{/if}>
			{if not $smarty.request.print}
			<input type="checkbox"
			onclick="javascript:check_item('ok2',{$list_item.tp_kod},'ok_ts',this.checked,'fakt_bonus')"
			{if $list_item.ok_ts eq 1}checked{/if}
			{if not $list_item.ok_traid neq 1 or not $is_ts or $list_item.tn neq $tn or $list_item.ok_chief eq 1}disabled{/if}
			>
			{$list_item.ok_ts_date}
			<input class="number" name=fakt_bonus[{$list_item.tp_kod}] size=11
			{if not $list_item.ok_ts or not $list_item.ok_traid neq 1 or not $is_ts or $list_item.tn neq $tn or $list_item.ok_chief eq 1}disabled{/if}
			required value="{$list_item.fakt_bonus}"
			>
			{else}
				{if $list_item.ok_ts eq 1}да{/if} {$list_item.fakt_bonus}
			{/if}
		</td>
		<td>
			{if not $smarty.request.print}
			<input type="checkbox"
			onclick="javascript:check_item('ok2',{$list_item.tp_kod},'ok_chief',this.checked)"
			{if $list_item.ok_chief eq 1}checked{/if}
			{if not $list_item.ok_traid neq 1 or $list_item.ok_ts neq 1 or $list_item.parent_tn neq $tn}disabled{/if}
			>
			{$list_item.parent_fio}
			{else}
				{if $list_item.ok_chief eq 1}да{/if} {$list_item.parent_fio}
			{/if}
		</td>
			{if not $smarty.request.print}
				<input type=hidden name=ok2[ok_traid][{$list_item.tp_kod}]>
				<input type=hidden name=ok2[ok_ts][{$list_item.tp_kod}]>
				<input type=hidden name=ok2[ok_chief][{$list_item.tp_kod}]>
			{/if}
	</tr>
	{/foreach}
	{foreach key=list_key item=list_item from=$list_total name=list_total}
	<tr style="font-weight:bold">
		<td colspan=6>Итого ТП: {$list_item.tp_kod|default:0}</td>
			<td style="text-align:right">{$list_item.sales7|default:0|num:2}</td>
			<td style="text-align:right">{$list_item.sales8|default:0|num:2}</td>
			<td style="text-align:right">{$list_item.rost_perc|default:0|num:2}</td>
			<td style="text-align:right">{$list_item.rost_uah|default:0|num:2}</td>
			<td style="text-align:right">{$list_item.bonus_plan|default:0|num:2}</td>
			<td></td>
			<td style="text-align:right">{$list_item.ok_traid|default:0}</td>
			<td></td>
			<td style="text-align:right">{$list_item.fakt_bonus|default:0|num:2}</td>
			<td style="text-align:right">{$list_item.ok_chief|default:0}</td>
	</tr>
	{/foreach}
</table>


{if not $smarty.request.print}
<p><input type=submit name=save id=save class=save value="Сохранить"></p>
{/if}


<h2>Итоги акции по ТП, не запрещенных ВСТМ</h2>


<table border=1 cellspacing=0 cellpadding=3>
	<tr style="font-weight:bold">
		<td>Всего ТП</td>
		<td>Прирост продаж, %</td>
		<td>Прирост продаж, {$valuta}</td>
		<td>Бонус расчетный, {$valuta}</td>
		<td>Бонус фактический, {$valuta}</td>
		<td>Затраты на акцию (от факта продаж), %</td>
		<td>Затраты на акцию (от прироста продаж), %</td>
		<td>Подарок выдан ТС-ом</td>
		<td>Подтверждено руководителем</td>
	</tr>
	{foreach key=list_key item=list_item from=$list_total_itogi name=list_total_itogi}
	<tr style="font-weight:bold">
			<td style="text-align:right">{$list_item.tp_kod|default:0}</td>
			<td style="text-align:right">{$list_item.rost_perc|default:0|num:2}</td>
			<td style="text-align:right">{$list_item.rost_uah|default:0|num:2}</td>
			<td style="text-align:right">{$list_item.bonus_plan|default:0|num:2}</td>
			<td style="text-align:right">{$list_item.fakt_bonus|default:0|num:2}</td>
			<td style="text-align:right">{$list_item.zat_perc_f|default:0|num:2}</td>
			<td style="text-align:right">{$list_item.zat_perc_p|default:0|num:2}</td>
			<td style="text-align:right">{$list_item.ok_ts|default:0|num:2}</td>
			<td style="text-align:right">{$list_item.ok_chief|default:0|num:2}</td>
	</tr>
	{/foreach}
</table>


<h2>Сканкопии подтверждающих документов</h2>

<table border=1 cellspacing=0 cellpadding=3>
	<tr style="font-weight:bold">
		<td>ФИО ТС</td>
		<td>Название файла-сканкопии</td>
		<td>Сумма к компенсации дистрибутору, {$valuta}</td>
		<td>Подтверждено ВСТМ</td>
		<td>Комментарий ВСТМ</td>
	</tr>
	{foreach key=key item=item from=$file_list}
	{foreach key=file_list_key item=file_list_item from=$item.data}
	<tr style="text-align:center" bgcolor="{cycle values="#ccffff,#ffffcc"}">
		<td style="text-align:left">{$file_list_item.fio_ts}</td>
		<td>
{if not $smarty.request.print}
			<a target=_blank href="truf_oct_files/{$file_list_item.tn}/{$file_list_item.fn}">{$file_list_item.fn}</a>
{else}
			{$file_list_item.fn}
{/if}
		</td>
		<td style="text-align:right">{$file_list_item.bonus|default:0}</td>
		<td style="text-align:center" {if $file_list_item.ok_traid eq '1'}bgcolor="#00ff00"{/if}>
{if not $smarty.request.print}
			<input
				class="chk_all"
				name="cb_traid[]"
				type=checkbox
				onclick="javascript:check_item('ok_files',{$file_list_item.id},'ok_traid',this.checked)"
				{if $file_list_item.ok_traid eq 1}checked{/if}
				{if not $is_traid or $file_list_item.ok_ts eq 1 or $file_list_item.ok_chief eq 1}disabled{/if}
			>
			{if $file_list_item.ok_traid eq 1}да{/if}{if $file_list_item.ok_traid eq '0'}нет{/if}
			<input type=hidden name=ok_files[ok_traid][{$file_list_item.id}]>
{else}
			{if $file_list_item.ok_traid eq 1}да{/if}
{/if}
		</td>
		<td style="text-align:center">
{if not $smarty.request.print}
			<input name=text_files[text_traid][{$file_list_item.id}]
			{if not $is_traid or $file_list_item.ok_ts eq 1 or $file_list_item.ok_chief eq 1}disabled{/if}
			value="{$file_list_item.text_traid}"
			>
{else}
			{$file_list_item.text_traid}
{/if}
		</td>
	</tr>
	{/foreach}

	<tr style="text-align:center;font-weight:bold" bgcolor="{cycle values="#ccffff,#ffffcc"}">
		<td style="text-align:left" colspan=5>Итого: {$item.data_total.summa}</td>
	</tr>


	{/foreach}
	<tr style="text-align:center;font-weight:bold" bgcolor="green">
		<td style="text-align:left" colspan=5>Итого по всем ТС: {$file_list_total}</td>
	</tr>
</table>
