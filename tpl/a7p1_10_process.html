<h1>Ход акции "7+1" (Октябрь)</h1>

<form target="_self" method="POST" name=form_tp id=form_tp enctype="multipart/form-data">


По ЭТА:
<br>
<select name=eta_list id=eta_list onchange="javascript:fn_submit('eta_list');">
<option value=""></option>
{foreach key=key item=item from=$eta_list}
<option value={$item}>{$item}</option>
{/foreach}
</select>

<br>
<br>

<script>$("#eta_list option[value='{$smarty.request.eta_list}']").prop('selected', true);</script>


<input type="hidden" name="form_submit" id=form_submit>

{literal}
<script>
function fn_submit(val)
{
	$('#form_submit').val(val);
	$('#form_tp').submit();
}
</script>
{/literal}






Выберите ТП:
<select name=selected_tp id=selected_tp>
	<option></option>
	{foreach key=tp_key item=tp_item from=$tp name=tp}
	<option value="{$tp_item.tp_kod}">{$tp_item.tp_kod} {$tp_item.tp_ur} ({$tp_item.tp_addr})</option>
	{/foreach}
</select>


<script>$("#selected_tp option[value='{$smarty.request.selected_tp}']").prop('selected', true);</script>


<br>
<br>
<input type=submit name=refresh id=refresh value="Выбрать ТП">
<br>


<br>

{if $smarty.request.selected_tp}
	{foreach key=tp_key item=tp_item from=$tp name=tp}
		{if $smarty.request.selected_tp eq $tp_item.tp_kod}
		Отгрузки клиента <b>{$tp_item.tp_ur} {$tp_item.tp_addr}</b> за октябрь, ЭТА <b>{$tp_item.fio_eta}</b>
		{/if}
	{/foreach}
{/if}


<br>
<br>


<table border=1 cellspacing=0 cellpadding=3 width=600px>
	<tr style="font-weight:bold;text-align:center">
		<td>Номер накладной</td>
		<td>Дата накладной</td>
		<td>Сумма по накладной, {$valuta}.</td>
		<td>Сумма продаж весовых конфет в накладной, {$valuta}</td>
		<td>Количество ящиков весовых конфет в накладной</td>
		<td>Присутствует акционный набор</td>
		<td>Акционная накладная</td>
<!--		<td>Количество  бонусных ящиков</td>-->
		<td>Сумма бонуса, {$valuta}.</td>
		<td>Комментарий</td>
	</tr>
	{foreach key=nakl_list_key item=nakl_list_item from=$nakl_list name=nakl_list}
	<tr {if $nakl_list_item.action_nakl eq 1}bgcolor="#00ff00"{/if} bgcolor="{cycle values="#ccffff,#ffffcc"}">
		<td>{$nakl_list_item.nakl}</td>
		<td>{$nakl_list_item.data}</td>
		<td style="text-align:right">{$nakl_list_item.summa|default:0|num:2}</td>
		<td style="text-align:right">{$nakl_list_item.summnds_pg|default:0|num:2}</td>
		<input type=hidden name=summnds_pg[{$nakl_list_item.nakl}] value="{$nakl_list_item.summnds_pg}">
		<td style="text-align:right">{$nakl_list_item.action_qt_ya|default:0}</td>
		<td style="text-align:right">{if $nakl_list_item.action_sum_ya eq 1}да{else}нет{/if}</td>
		<td>
			<input
				{if not $nakl_list_item.ok_traid neq 1 or $nakl_list_item.ok_chief eq 1}disabled{/if} {if $nakl_list_item.action_nakl neq 1} disabled {/if}
				onclick="javascript:check_item1('{$nakl_list_item.nakl}','selected','bonus','text','ya',true)"
				type=checkbox
				{if $nakl_list_item.selected eq 1}checked{/if}
				name=selected_on[{$nakl_list_item.nakl}]
				value="{$nakl_list_item.nakl}"
			>
			<input type=hidden name=selected_changed[{$nakl_list_item.nakl}] value="">
		</td>
		<td>
			<input {if not $nakl_list_item.ok_traid neq 1 or $nakl_list_item.ok_chief eq 1}disabled{/if} {if $nakl_list_item.selected neq 1} disabled {/if} class="number" name=bonus[{$nakl_list_item.nakl}] id=bonus[{$nakl_list_item.nakl}] value="{$nakl_list_item.bonus}" required>
		</td>
		<td>
			<input {if not $nakl_list_item.ok_traid neq 1 or $nakl_list_item.ok_chief eq 1}disabled{/if} {if $nakl_list_item.selected neq 1} disabled {/if} name=text[{$nakl_list_item.nakl}] id=text[{$nakl_list_item.nakl}] value="{$nakl_list_item.text|escape}">
		</td>
	</tr>
	{/foreach}
</table>

<br>
<input type=submit name=add id=add value="Добавить накладные в акцию">
<br>
<br>


<table border=1 cellspacing=0 cellpadding=3>
	<tr style="font-weight:bold">
		<td><a href="javascript:void(0)" onclick="javascript:form_tp.submit()">[x]</a></td>
		<td>ТС</td>
		<td>ЭТА</td>
		<td>Код ТП</td>
		<td>Название ТП</td>
		<td>Адрес ТП</td>
		<td>Номер<br>накладной</td>
		<td>Дата<br>накладной</td>

		<td>Сумма по накладной, {$valuta}.</td>
		<td>Сумма продаж весовых конфет в накладной, {$valuta}</td>
		<td>Количество ящиков весовых конфет в накладной</td>
<!--		<td>Количество  бонусных ящиков</td>-->
		<td>Сумма бонуса, {$valuta}.</td>
		<td>Комментарий</td>

	</tr>
	{foreach key=nakl_list_all_key item=nakl_list_all_item from=$nakl_list_all name=nakl_list_all}
	<tr bgcolor="{cycle values="#ccffff,#ffffcc"}">
		<td><input {if not $nakl_list_all_item.ok_traid neq 1 or $nakl_list_all_item.ok_chief eq 1}disabled{/if} type=checkbox name=del[{$nakl_list_all_item.tp_kod}][{$nakl_list_all_item.nakl}]></td>
		<td>{$nakl_list_all_item.fio_ts}</td>
		<td>{$nakl_list_all_item.fio_eta}</td>
		<td>{$nakl_list_all_item.tp_kod}</td>
		<td>{$nakl_list_all_item.tp_ur}</td>
		<td>{$nakl_list_all_item.tp_addr}</td>
		<td>{$nakl_list_all_item.nakl}</td>
		<td>{$nakl_list_all_item.data}</td>
		<td style="text-align:right">{$nakl_list_all_item.summa|default:0|num:2}</td>
		<td style="text-align:right">{$nakl_list_all_item.summnds_pg|default:0|num:2}</td>
		<td style="text-align:right">{$nakl_list_all_item.action_qt_ya|default:0}</td>
<!--		<td style="text-align:right">{$nakl_list_all_item.fakt_ya|default:0|num:0}</td>-->
		<td style="text-align:right">{$nakl_list_all_item.bonus|default:0|num:2}</td>
		<td style="text-align:right"><input {if not $nakl_list_all_item.ok_traid neq 1 or $nakl_list_all_item.ok_chief eq 1}disabled{/if} name=text_all[{$nakl_list_all_item.tp_kod}][{$nakl_list_all_item.nakl}] value="{$nakl_list_all_item.text|escape}"></td>
	</tr>
	{/foreach}
	<tr>
		<td colspan=8>ИТОГО накладных: {$nakl_list_all_total.c1|default:0}</td>
		<td style="text-align:right">{$nakl_list_all_total.summa|default:0|num:2}</td>
		<td style="text-align:right">{$nakl_list_all_total.summnds_pg|default:0|num:2}</td>
		<td style="text-align:right">{$nakl_list_all_total.action_qt_ya|default:0}</td>
<!--		<td style="text-align:right">{$nakl_list_all_total.fakt_ya|default:0}</td>-->
		<td style="text-align:right">{$nakl_list_all_total.bonus|default:0|num:2}</td>
	</tr>
</table>

<br>

<input type=submit name=save id=save class=save value="Сохранить">

<br>







<h2>Загрузка сканкопий реестра накладных на бонусную продукцию (размер одного файла - не более 3 MВ)</h2>

<input type="hidden" name="MAX_FILE_SIZE" value="3000000">
Загрузить файл с реестром <input type=file name=new_fn>
Сумма к компенсации дистрибутору, {$valuta}  <input class="number" name=new[bonus]>
<input type=submit name=save id=save value="Добавить">
 
<br>
<br>



 
<table border=1 cellspacing=0 cellpadding=3>
	<tr style="font-weight:bold">
		<td><a href="javascript:void(0)" onclick="javascript:form_tp.submit()">[x]</a></td>
		<td>Название файла-сканкопии</td>
		<td>Сумма к компенсации дистрибутору, {$valuta}</td>
		<td>Подтверждено ВСТМ</td>
	</tr>
	{foreach key=file_list_key item=file_list_item from=$file_list name=file_list}
	<tr style="text-align:center"   bgcolor="{cycle values="#ccffff,#ffffcc"}">
		<td><input {if $file_list_item.ok_traid eq 1}disabled{/if} type=checkbox name=del_file[{$file_list_item.id}]></td>
		<td><a target=_blank href="a7p1_10_files/{$file_list_item.tn}/{$file_list_item.fn}">{$file_list_item.fn}</a></td>
		<td style="text-align:right">{$file_list_item.bonus|default:0|num:2}</td>
		<td {if $file_list_item.ok_traid eq '1'}bgcolor="#00ff00"{/if}>{if $file_list_item.ok_traid eq '1'}да{/if}{if $file_list_item.ok_traid eq '0'}нет{/if}</td>
	</tr>
	{/foreach}
</table>







</form>

{literal}
<script>
function check_item1($v,$v2,$v3,$v4,$v5,required)
{
	var e = document.forms["form_tp"].elements[$v3+"["+$v+"]"];
	var e1 = document.forms["form_tp"].elements[$v4+"["+$v+"]"];
	var e2 = document.forms["form_tp"].elements[$v5+"["+$v+"]"];
	var cbs = document.forms["form_tp"].elements[$v2+"_on["+$v+"]"];
	var cbs2 = document.forms["form_tp"].elements[$v2+"_changed["+$v+"]"];
	if (cbs.checked)
	{
		cbs2.value='on';
		e.disabled=false;
		e1.disabled=false;
		e2.disabled=false;
		e["required"]="required";
		e2["required"]="required";
	}
	else
	{
		cbs2.value=$v;
		e.disabled=true;
		e1.disabled=true;
		e2.disabled=true;
	}
}
</script>
{/literal}
