<h3>Реестр отчетов по активности</h3>
<form target="_self" method="POST" name=form_bud_ru_zay_report id=form_bud_ru_zay_report enctype="multipart/form-data">

<table>
	<tr>
		<td style="text-align:right">По дате с/по</td>
		<td>
			<input type=radio name=date_between_brzr value='dt12'>
			заявки
			<input type=radio name=date_between_brzr value='dt34'>
			начала активности
			<input size=10 class="dt12 datepicker" name=dates_list1 id=dates_list1>
			<input size=10 class="dt12 datepicker" name=dates_list2 id=dates_list2>
			<script>
				$('#dates_list1').val('{$smarty.request.dates_list1}');
				$('#dates_list2').val('{$smarty.request.dates_list2}');
			</script>
		</td>
	</tr>
<script>
$("input[name=date_between_brzr][value={$smarty.request.date_between_brzr}]").attr('checked',true);
$("input[name=date_between_brzr][value={$smarty.request.date_between_brzr}]").click();
</script>
	<tr>
		<td style="text-align:right">Инициатор</td>
		<td>
			<select name=creator id=creator>
				<option value=0></option>
				{foreach key=key item=item from=$creators_list}
				<option value={$item.tn}>{$item.fio} - {$item.dpt_name}</option>
				{/foreach}
			</select>
			<script>$('#creator option[value="{$smarty.request.creator}"]').prop('selected', true);</script>
		</td>
	</tr>
	<tr>
		<td style="text-align:right">Статья расходов</td>
		<td>
			<select name=st id=st>
				<option value=0></option>
				{foreach key=key item=item from=$st}
				{if $item.parent eq 0}<option value={$item.id}>{$item.name}</option>{/if}
				{/foreach}
			</select>
			<script>$('#st option[value="{$smarty.request.st}"]').prop('selected', true);</script>
		</td>
	</tr>
	<tr>
		<td style="text-align:right">Категория статьи расходов</td>
		<td>
			<select name=kat id=kat>
				<option value=0></option>
				{foreach key=key item=item from=$st}
					<option
						{if $item.parent eq 0}disabled style="background-color: rgb(200, 200, 200);"{/if}
						value="{$item.id}"
					>{$item.name|escape}</option>
				{/foreach}
			</select>
			<script>$('#kat option[value="{$smarty.request.kat}"]').prop('selected', true);</script>
		</td>
	</tr>
	<tr>
		<td style="text-align:right">Дистрибьютор</td>
		<td>
			<select name=fil id=fil>
				<option value=0></option>
				{foreach key=key item=item from=$fil_list}
				<option value="{$item.id}">{$item.name}</option>
				{/foreach}
			</select>
			<script>$('#fil option[value="{$smarty.request.fil}"]').prop('selected', true);</script>
		</td>
	</tr>
	<tr>
		<td style="text-align:right">Фонд</td>
		<td>
			<select name=funds id=funds>
				<option value=0></option>
				{foreach key=key item=item from=$funds_list}
				<option value="{$item.id}">{$item.name}</option>
				{/foreach}
			</select>
			<script>$('#funds option[value="{$smarty.request.funds}"]').prop('selected', true);</script>
		</td>
	</tr>
	<tr>
		<td style="text-align:right">Сеть</td>
		<td>
			<select name=id_net id=id_net>
				<option value=0></option>
				{foreach key=key item=item from=$nets}
				<option value="{$item.id_net}">{$item.net_name}</option>
				{/foreach}
			</select>
			<script>$('#id_net option[value="{$smarty.request.id_net}"]').prop('selected', true);</script>
		</td>
	</tr>
	<tr>
		<td style="text-align:right">Страна</td>
		<td>
			<select name=country id=country>
				<option value='0'></option>
				{foreach key=key item=item from=$countries}
				{if $item.checked eq 1}
				<option value='{$item.cnt_kod}'>{$item.cnt_name}</option>
				{/if}
				{/foreach}
			</select>
			<script>
			{if $smarty.request.country neq ''}
				$('#country option[value="{$smarty.request.country}"]').prop('selected', true);
			{else}
				$('#country option[value="{$cnt_kod}"]').prop('selected', true);
			{/if}
			</script>
		</td>
	</tr>
	<tr>
		<td style="text-align:right">Должность</td>
		<td>
			<select name=bud_ru_zay_pos_id id=bud_ru_zay_pos_id>
				<option value=0></option>
				{foreach key=key item=item from=$pos_list}
				<option value={$item.pos_id}>{$item.pos_name}</option>
				{/foreach}
			</select>
			<script>$('#bud_ru_zay_pos_id option[value="{$smarty.request.bud_ru_zay_pos_id}"]').prop('selected', true);</script>
		</td>
	</tr>
	<tr>
		<td style="text-align:right">Регион</td>
		<td>
			<select name=region_name id=region_name>
				<option value=0></option>
				{foreach key=key item=item from=$region_list}
				<option value="{$item.region_name}">{$item.region_name}</option>
				{/foreach}
			</select>
			<script>$('#region_name option[value="{$smarty.request.region_name}"]').prop('selected', true);</script>
		</td>
	</tr>
	<tr>
		<td style="text-align:right">Подразделение</td>
		<td>
			<select name=department_name id=department_name>
				<option value=0></option>
				{foreach key=key item=item from=$department_list}
				<option value="{$item.department_name}">{$item.department_name}</option>
				{/foreach}
			</select>
			<script>$('#department_name option[value="{$smarty.request.department_name}"]').prop('selected', true);</script>
		</td>
	</tr>
	<tr>
		<td style="text-align:right">Фильтр по мне</td>
		<td>
			<input checked="checked" name="who" id="who" value="0" type="radio"> все
			<input name="who" id="who" value="1" type="radio"> я - инициатор
			<input name="who" id="who" value="2" type="radio"> я - согласовываю
			<script>$("input[name=who][value={$smarty.request.who}]").attr('checked',true);</script>
		</td>
	</tr>
	<tr>
		<td style="text-align:right">Фильтр по статусу</td>
		<td>
			<input checked="checked" name="status" id="status" value="0" type="radio"> все
			<input name="status" id="status" value="1" type="radio"> подтвержденные
			<input name="status" id="status" value="2" type="radio"> еще на согласовании
			<input name="status" id="status" value="3" type="radio"> отклоненные
			<input name="status" id="status" value="4" type="radio"> недействительные
			<script>$("input[name=status][value={$smarty.request.status}]").attr('checked',true);</script>
		</td>
	</tr>
	<tr>
		<td style="text-align:right">Фильтр по статусу 2</td>
		<td>
			<input checked="checked" name="wait4myaccept" id="wait4myaccept" value="1" type="radio"> все
			<input name="wait4myaccept" id="wait4myaccept" value="0" type="radio"> ожидают моего согласования
			<script>$('input[name=wait4myaccept][value={$smarty.request.wait4myaccept}]').attr('checked',true);</script>
		</td>
	</tr>
	<tr>
		<td style="text-align:right">Фильтр по предоставлению отчета</td>
		<td>
			<input checked="checked" name="report_done_flt" id="report_done_flt" value="0" type="radio"> все
			<input name="report_done_flt" id="report_done_flt" value="1" type="radio"> отчет предоставлен
			<input name="report_done_flt" id="report_done_flt" value="2" type="radio"> отчет не предоставлен
			<script>$('input[name=report_done_flt][value={$smarty.request.report_done_flt}]').attr('checked',true);</script>
		</td>
	</tr>
	<tr>
		<td style="text-align:right">Фильтр по сроку подачи отчета</td>
		<td>
			<input checked="checked" name="srok_ok" id="srok_ok" value="0" type="radio"> все
			<input name="srok_ok" id="srok_ok" value="1" type="radio"> срок не истек
			<input name="srok_ok" id="srok_ok" value="2" type="radio"> срок истек
			<script>$('input[name=srok_ok][value={$smarty.request.srok_ok}]').attr('checked',true);</script>
		</td>
	</tr>
	<tr>
		<td style="text-align:right;vertical-align:top">Динамический фильтр по полям ЗАЯВКИ</td>
		<td id="td1">
			<a href="javascript:void(0);" onClick="f1();">добавить фильтр</a><br>
			<script>
			var a=1;
			{literal}

			function get_list(id,v,item)
			{
			x=loadwait_show('subtype_list_'+id);
			$('#subtype_list_'+id).load(
			'?action=bud_ru_ff_subtypes_get_list&nohead=1&id='+id+'&subtype='+v+'&item='+item
			,
			{
			}
			,
			function() {
				loadwait_hide(x);
				
			}
			);
			}

			function f1(val1,val2)
			{
				$('#td1').append('<div style="display:inline" id=st'+a+'></div>');
				$('#st'+a).load('?action=bud_ru_ff_subtypes&nohead=1',{id: a, subtype: val1, item: val2});
				a++;
			}
			{/literal}
			{foreach key=k item=i from=$smarty.request.dyn_flt}{if $i.subtype and $i.item}f1({$i.subtype},{$i.item});{/if}{/foreach}

			</script>
		</td>
	</tr>
	<tr>
		<td style="text-align:right">Поиск по номеру</td>
		<td>
			<input onChange="this.value==''?this.value=0:null;" class="number_int" name="z_id" value="{$smarty.request.z_id}">
			{if $find_bud_ru_zay}
				{if $find_bud_ru_zay.exist eq 0}
					<font style="font-weight:bold;color:red">Заявка с указанным номером не найдена</font>
				{else}
					{if $find_bud_ru_zay.visible eq 0}
						<font style="font-weight:bold;color:red">Заявка в реестре найдена, но у вас нет прав для ее просмотра</font>
					{/if}
				{/if}
			{/if}
		</td>
	</tr>

</table>

<p>
	<input type="submit" name="select" id="select" value="Отобразить реестр">
	{if $is_do or $is_traid or $is_traid_kk or $is_db}
		<input type="submit" name="save" id="save" value="Сохранить">
	{/if}
</p>

</form>




{if $smarty.request.select and not $smarty.request.z_id}

<h3>Сводные данные</h3>

<table border=1 cellspacing=0 cellpadding=3>
	<tr style="font-weight:bold;text-align:center">
		<td rowspan=2>название</td>
		{foreach key=key item=item from=$bud_ru_ff_st_ras name=bud_ru_ff_st_ras}{/foreach}
		<td colspan="{$smarty.foreach.bud_ru_ff_st_ras.total}">cтатьи расходов (план / факт)</td>
	</tr>

	<tr style="font-weight:bold;text-align:center">
	{foreach key=key item=item from=$bud_ru_ff_st_ras name=bud_ru_ff_st_ras}
		<td>{$item.name}</td>
	{/foreach}
	</tr>
	{foreach key=key item=item from=$bud_ru_ff}
	<tr style="text-align:center">
		<td style="text-align:left">{$item.name|escape}</td>
		{foreach key=bk item=bi from=$bud_ru_ff_st_ras name=bud_ru_ff_st_ras}
			{assign var="x" value="0"}
			{foreach key=sk item=si from=$bud_ru_ff_st name=bud_ru_ff_st}
				{if $si.ff eq $item.id and $si.st eq $bi.id}
					{assign var="x" value=`$si.v`}
					{assign var="rep_x" value=`$si.rep_v`}
				{/if}
			{/foreach}
			<td>{$x} / {$rep_x}</td>
		{/foreach}
	</tr>
	{/foreach}
</table>

{/if}

{if $smarty.request.select or $smarty.request.z_id}

<h3>Реестр</h3>

<table border=1 cellpadding=5 cellspacing=0>
	<tr style="text-align:center;font-weight:bold">
		<td rowspan=2>Заголовок заявки</td>
		<td rowspan=2>Поля заявки</td>
		<td rowspan=2>Отчет по заявке</td>
		<td colspan=3>Блок согласования</td>
	</tr>
	<tr style="text-align:center;font-weight:bold">
		<td>
				Должность, подразделение, <font style="color:red">согласователь</font>
				<font style="color:green">статус</font>
				<font style="color:blue">дата</font>
		</td>
		<td>Причина отказа</td>
		<td>Комментарии / Уточнения</td>
	</tr>
	{foreach key=k item=i from=$d}

<form target="_self" method="POST" enctype="multipart/form-data">

	{if $i.head.current_status eq 464260}{assign var=color value="#FFFF66"}{/if}
	{if $i.head.current_status eq 464261}{assign var=color value="#66FF66"}{/if}
	{if $i.head.current_status eq 464262}{assign var=color value="#FFCC99"}{/if}
	{if $i.head.valid_no eq 1}{assign var=color value="#66FFFF"}{/if}



	<tr style="background-color:{$color};vertical-align:top">
		<td>
	{if $is_do or $is_traid or $is_traid_kk or $is_db}
		<input type="submit" name="save" id="save" value="Сохранить"><br>
	{/if}
{if $i.head.net_name}
<p style="border:1px dotted red">
			<b>Сеть:</b>{$i.head.net_name}<br>
			<b>Форма оплаты:</b>{$i.head.payment_type_name}<br>
			<b>Статья затрат:</b>{$i.head.statya_name}<br>
			<b>Возмещение дистрибутору:</b>{if $i.head.distr_compensation eq 1}да{else}нет{/if}<br>
</p>
{/if}
			<b>№ Заявки:</b>{$i.head.id}<br>
			<b>Дата создания:</b>{$i.head.created}<br>
			<b>Дата начала проведения активности:</b>{$i.head.dt_start}<br>
			<b>Дата окончания проведения активности:</b>{$i.head.dt_end}<br>
			<b>Регион / Подразделение:</b>{$i.head.region_name}<br>
			<b>ФИО РМ:</b>{$i.head.rm_fio}<br>
			<b>Мобильный телефон:</b>{$i.head.phone}<br>
			<b>Электронный корпоративный адрес:</b>{$i.head.e_mail}<br>
			<b>Скайп:</b>{$i.head.skype}<br>
			<b>Статья:</b>{$i.head.st_name}<br>
			<b>Категория:</b>{$i.head.kat_name}<br>
			<b>Дистрибьютор:</b>{$i.head.fil_name}<br>
			<b>Фонд:</b>{$i.head.funds_name}<br>
			<b>Инициатор:</b>{$i.head.creator_pos_name},{$i.head.creator_department_name},<font style="color:red">{$i.head.creator}</font><br>
			<b>Адресат:</b>{$i.head.recipient_pos_name},{$i.head.recipient_department_name},<font style="color:red">{$i.head.recipient}</font><br>
			<b>Дата отчета по заявке:</b><br>
			{if $i.head.report_data}
				{$i.head.report_data}<br>
				<font style="font-weight:bold;color:green">{$i.head.report_data_fio|escape} {$i.head.report_data_lu}</font><br>
				{$i.head.report_data_text|nl2br}<br>
			{/if}
			{if $i.head.report_short eq 1}<font style="font-weight:bold;color:green">Сокращенный отчет</font><br>{/if}
		</td>
		<td>
			{foreach key=k1 item=i1 from=$i.ff}
				<b>{$i1.name}:&nbsp</b>
				{if $i1.type eq 'formula'}	{$i1.val_formula|num:3}{/if}
				{if $i1.type eq 'list'}		{$i1.val_list_name}{/if}
				{if $i1.type eq 'string'}	{$i1.val_string}{/if}
				{if $i1.type eq 'textarea'}	{$i1.val_textarea}{/if}
				{if $i1.type eq 'number_int'}	{$i1.val_number_int|num:0}{/if}
				{if $i1.type eq 'number'}	{$i1.val_number|num:5}{/if}
				{if $i1.type eq 'datepicker'}	{$i1.val_datepicker}{/if}
				{if $i1.type eq 'bool'}		{if $i1.val_bool eq 1}да{else}нет{/if}{/if}
				{if $i1.type eq 'file'}
					{foreach key=k2 item=i2 from=$i1.val_file}
						<nobr><a target=_blank href="bud_ru_zay_files/{$i.head.id}/{$i1.ff_id}/{$i2}">{$i2}</a></nobr>&nbsp
					{/foreach}
				{/if}
				<br>
			{/foreach}
		</td>
		<td style="text-align:center">
			<b>Срок подачи отчета:</b>
			{if $i.head.srok_ok eq 1}
				<font style="background-color:#66FF66">не истек</font>
			{else}
				<font style="background-color:#FFCC99">истек</font>
			{/if}
			<br>
			<b>Подтверждение:</b>
			{if $i.head.current_status eq 464260}<font style="background-color:#FFFF66">отчет на согласовании</font>{/if}
			{if $i.head.current_status eq 464261}<font style="background-color:#66FF66">подтвержден</font>{/if}
			{if $i.head.current_status eq 464262}<font style="background-color:#FFCC99">отклонен</font>{/if}
			<br>
			<b>Отчет заполнен: </b>
			{if $i.head.creator_tn eq $tn and $i.head.not_seen}
					<input
						{if $i.head.report_done}checked{/if}
						onClick="
							$('#report_done_{$i.head.id}').attr('disabled',false);
							$('#report_done_{$i.head.id}').val(this.checked?1:0);
						"
						type="checkbox"
					>
					<input
						{if $i.head.report_done}value=1{/if}
						disabled
						name="report_done[{$i.head.id}]"
						id="report_done_{$i.head.id}"
						type="hidden"
					>
			{/if}
			{if $i.head.report_done}
				<font style="background-color:#66FF66">{$i.head.report_done_lu}</font>
			{else}
				<font style="background-color:#FFCC99">нет</font>
			{/if}
			<br>
			<table style="text-align: left; width: 100%;" border="1" cellpadding="2" cellspacing="0">
				<tr style="font-weight:bold">
					<td style="vertical-align: top;">Плановый показатель<br></td>
					<td style="vertical-align: top;">Фактический показатель<br></td>
				</tr>
				{foreach key=k1 item=i1 from=$i.ff}
				{if $i1.rep_r_visible}
				<tr>
					<td>
					<b>{$i1.name}:&nbsp</b>
					{if $i1.type eq 'formula'}	{$i1.val_formula|num:3}{/if}
					{if $i1.type eq 'list'}		{$i1.val_list_name}{/if}
					{if $i1.type eq 'string'}	{$i1.val_string}{/if}
					{if $i1.type eq 'textarea'}	{$i1.val_textarea}{/if}
					{if $i1.type eq 'number_int'}	{$i1.val_number_int|num:0}{/if}
					{if $i1.type eq 'number'}	{$i1.val_number|num:5}{/if}
					{if $i1.type eq 'datepicker'}	{$i1.val_datepicker}{/if}
					{if $i1.type eq 'bool'}		{if $i1.val_bool eq 1}да{else}нет{/if}{/if}
					{if $i1.type eq 'file'}
						{foreach key=k2 item=i2 from=$i1.val_file}
							<nobr><a target=_blank href="bud_ru_zay_files/{$i.head.id}/{$i1.ff_id}/{$i2}">{$i2}</a></nobr>&nbsp
						{/foreach}
					{/if}
						</td>
						<td>
					<b>{$i1.rep_name}:&nbsp</b>
					{if $i.head.creator_tn eq $tn and $i.head.not_seen}
						{if $i1.type eq 'textarea'}
							<textarea id=new_st_{$i1.id} name=new_st[{$i1.id}] {if $i1.rep_required}required{/if}>{$i1.rep_val_textarea}</textarea>
						{else}
							{if $i1.type eq 'file'}
								<input id=new_st_{$i1.id} name=new_st[{$i1.id}][] type=file multiple {if $i1.rep_required and not $i1.rep_val_file}required{/if}>
								{foreach key=k2 item=i2 from=$i1.rep_val_file}
									<br><input type=checkbox name="bud_ru_zay_files_del[{$i1.id}][{$i2}]" value="bud_ru_zay_files/{$i.head.id}/{$i1.ff_id}/report/{$i2}"><nobr><a target=_blank href="bud_ru_zay_files/{$i.head.id}/{$i1.ff_id}/report/{$i2}">{$i2}</a></nobr>
								{/foreach}
								{if $i1.rep_val_file}<br>Выбрать для удаления{/if}
							{else}
								{if $i1.type eq 'list'}
									<select id=new_st_{$i1.id} name=new_st[{$i1.id}] {if $i1.required}required{/if}>
										<option></option>
										{foreach key=lk item=li from=$i1.list}	
											<option value={$li.id}>{$li.name}</option>
										{/foreach}
									</select>
									<script>
										$('#new_st_{$i1.id} option[value={$i1.rep_val_list}]').prop('selected', true);
									</script>
								{else}
									{if $i1.type eq 'bool'}
										<input
											type=checkbox
											id=new_st_{$i1.id}_cb
											{if $i1.required}required{/if}
											onChange="$('#new_st_{$i1.id}_val').val(this.checked?1:'');"
										>
										<input
											type=hidden
											id=new_st_{$i1.id}_val
											name=new_st[{$i1.id}]
											{if $i1.required}required{/if}
										>
										<script>
											$("#new_st_{$i1.id}_cb").attr('checked','{$i1.rep_val_bool}'=='1'?true:false);
											$("#new_st_{$i1.id}_val").val({$i1.rep_val_bool});
										</script>
									{else}
                                                        			{if $i1.type eq 'formula'}
											<input type=hidden name=new_st[{$i1.id}] value=0>
											<!--
											{$i1.formula}
											-->
											<input disabled id=new_st_{$i1.id} class="number5">
											<script>
												$('#new_st_{$i1.id}').val("{$i1.rep_val_formula}");
											</script>
										{else}
											<!--
											{$i1.var_name}
											{$i1.rep_var_name}
											-->
											<input
												id=new_st_{$i1.id}
												name=new_st[{$i1.id}]
												class="{$i1.class}"
												{if $i1.required}required{/if}
												onKeyUp="calc_formula();"
											>
											<!--
											<input id=new_st_{$i1.id} name=new_st[{$i1.id}] class="{$i1.class}" {if $i1.required}required{/if}>
											-->
											<script>
												{if $i1.type eq 'string'}$('#new_st_{$i1.id}').val("{$i1.rep_val_string}");{/if}
												{if $i1.type eq 'number_int'}$('#new_st_{$i1.id}').val("{$i1.rep_val_number_int}");{/if}
												{if $i1.type eq 'number'}$('#new_st_{$i1.id}').val("{$i1.rep_val_number}");{/if}
												{if $i1.type eq 'datepicker'}$('#new_st_{$i1.id}').val("{$i1.rep_val_datepicker}");{/if}
											</script>
										{/if}
									{/if}
								{/if}
							{/if}
						{/if}
					{else}
						{if $i1.type eq 'textarea'}	{$i1.rep_val_textarea}{/if}
						{if $i1.type eq 'file'}
							{foreach key=k2 item=i2 from=$i1.rep_val_file}
								<nobr><a target=_blank href="bud_ru_zay_files/{$i.head.id}/{$i1.ff_id}/report/{$i2}">{$i2}</a></nobr>&nbsp
							{/foreach}
						{/if}
						{if $i1.type eq 'formula'}	{$i1.rep_val_formula|num:3}{/if}
						{if $i1.type eq 'list'}		{$i1.rep_val_list_name}{/if}
						{if $i1.type eq 'string'}	{$i1.rep_val_string}{/if}
						{if $i1.type eq 'number_int'}	{$i1.rep_val_number_int|num:0}{/if}
						{if $i1.type eq 'number'}	{$i1.rep_val_number|num:5}{/if}
						{if $i1.type eq 'datepicker'}	{$i1.rep_val_datepicker}{/if}
						{if $i1.type eq 'bool'}		{if $i1.rep_val_bool eq 1}да{else}нет{/if}{/if}
					{/if}
					</td>
				</tr>
				{/if}
				{/foreach}
			</table>
			{if $i.head.creator_tn eq $tn and $i.head.not_seen}
				<b>Подтверждающие документы:&nbsp;</b> <input id="sup_doc_{$i.head.id}" name="sup_doc[{$i.head.id}][]" multiple="" type="file">
				{foreach key=k2 item=i2 from=$i.head.sup_doc}
					<br><input type=checkbox name="sup_doc_del[{$i.head.id}][{$i2}]" value="bud_ru_zay_files/{$i.head.id}/sup_doc/{$i2}"><nobr><a target=_blank href="bud_ru_zay_files/{$i.head.id}/sup_doc/{$i2}">{$i2}</a></nobr>
				{/foreach}
				{if $i.head.sup_doc}<br>Выбрать для удаления{/if}
			{else}
				{if $i.head.sup_doc}
				<b>Подтверждающие документы:&nbsp;</b>
				{foreach key=k2 item=i2 from=$i.head.sup_doc}
					<nobr><a target=_blank href="bud_ru_zay_files/{$i.head.id}/sup_doc/{$i2}">{$i2}</a></nobr>&nbsp
				{/foreach}
				{/if}
			{/if}
		</td>
		<td>
			{foreach key=k1 item=i1 from=$i.data name=rn}
				<b>{$smarty.foreach.rn.iteration}.</b>
				{$i1.acceptor_pos_name},
				{$i1.acceptor_department_name},
				<font style="color:red">{$i1.acceptor_name}</font>
				<font style="color:green; font-weight:bold">{$i1.accepted_name}</font>
				{if $i1.accepted_date}<font style="color:blue">{$i1.accepted_date}</font>{/if}
				<br>
			{/foreach}
		</td>
		<td>
			{foreach key=k1 item=i1 from=$i.data}
				{$i1.failure}<br>
			{/foreach}
		</td>
		<td>
			{if $i.zchat}
			<p>
			Комментарии по заявке:
			<br>
			{foreach key=k1 item=i1 from=$i.zchat}
				<font style="color:red">{$i1.zchat_time}</font>
				<font style="color:green">{$i1.zchater}:</font>
				<font style="color:blue">{$i1.ztext}</font>
				<br>
			{/foreach}
			</p>
			{/if}
			{if $i.chat}
			<p>
			Комментарии по отчету:
			<br>
			{foreach key=k1 item=i1 from=$i.chat}
				<font style="color:red">{$i1.chat_time}</font>
				<font style="color:green">{$i1.chater}:</font>
				<font style="color:blue">{$i1.text}</font>
				<br>
			{/foreach}
			</p>
			{/if}
			<p>
			<textarea rows=5 cols=20 name="bud_ru_zay_accept_chat[{$i.head.id}]"></textarea>
			<br>
			<input type="submit" name="add_chat" id="add_chat" value="Добавить">
			</p>
		</td>
	</tr>


</form>

	{/foreach}


	<tr style="text-align:left;font-weight:bold">
		<td colspan=11>
		ИТОГО: &nbsp
		{foreach key=k item=i from=$d1}
			{$i.current_status_txt} - {$i.c} &nbsp
		{/foreach}
		</td>
	</tr>







</table>



<script>
function calc_formula ()
{literal}{{/literal}
	{foreach key=k item=i from=$d}
		{foreach key=k1 item=i1 from=$i.ff}
			{if $i1.type eq 'number' or $i1.type eq 'number_int'}
				var {$i1.rep_var_name}=parseFloat($('#new_st_{$i1.id}').val());
			{/if}
		{/foreach}
		{foreach key=k1 item=i1 from=$i.ff}
			{if $i1.type eq 'formula'}
				var f='{$i1.rep_formula}';
				f=f.split("$").join("");
				var r=eval(f);
				r!=r?r=null:r=r.toFixed(3);
				$('#new_st_{$i1.id}').val(r);
			{/if}
		{/foreach}
	{/foreach}
{literal}}{/literal}
</script>


{/if}




