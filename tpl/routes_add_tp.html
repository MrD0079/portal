<form target="_self" method="POST" name=form1 id=form1>


<h1>Выбор ТП для маршрута</h1>
<table style="text-align: center; height: 34px; width: 100px;" border="0" cellpadding="5" cellspacing="5">
  <tbody>
    <tr>
      <td style=" width: 100px; text-align: left;">Выберите месяц 
	<select name=month_list id=month_list onchange="javascript:fn_submit('month_list');">
	{foreach key=key item=item from=$month_list}
		<option value="{$item.sd_c}">{$item.my}</option>
		{if $item.sd_c eq $smarty.request.month_list}
			{assign var=routes_enabled value=$item.routes_enabled}
		{/if}
	{/foreach}
	</select>
	<script>$("#month_list option[value='{$smarty.request.month_list}']").prop('selected', true);</script>

	<input value="Выбрать" name="select_month" type="submit"><br>
      </td>
    </tr>
  </tbody>
</table>
<br>






{if $is_mservice or $is_admin}

<hr style="width: 100%; height: 2px;"><span style="font-weight: bold;"><br>
Номера маршрутов</span><br>

<table style="text-align: left;" border="1" cellpadding="2" cellspacing="0">
<tbody><tr>
      <td style=" text-align: center;">удал.<br></td>
      <td style="text-align: center;">Номер маршрута<br></td>
      <td style="text-align: center;">ФИО отв. сотр.<br></td>
      <td style="text-align: center;">должность отв. сотр.<br></td>
      <td style="text-align: center;">ФИО создателя маршрута<br></td>
      <td style="text-align: center;">копировать<br>в<br>следующий<br>месяц</td>
      <td>
		Разделить маршрут<br>
		<font style="color:red">
		(кнопка "разделить" появится<br>при изменении полей<br>"с даты" и "ф.и.о. отв.")
		</font>
		</td>
    </tr>
	{foreach key=key item=item from=$routes_head}
    <tr>
      <td style=" text-align: center;"><input {if not $routes_enabled}disabled{/if} type=checkbox name="del[{$item.id}]"></td>
      <td style="text-align: center;"><input {if not $routes_enabled}disabled{/if} size="15" name="num[{$item.id}]" value="{$item.num}"></td>
      <td style="text-align: center;"><input {if not $routes_enabled}disabled{/if} size="25" name="fio_otv[{$item.id}]" value="{$item.fio_otv|escape}"></td>
      <td style="text-align: center;">
	<select name=pos_otv[{$item.id}] id=pos_otv_{$item.id} {if not $routes_enabled}disabled{/if}>
	{foreach key=key1 item=item1 from=$routes_pos}
		<option value="{$item1.id}">{$item1.name}</option>
	{/foreach}
	</select>
	<script>$("#pos_otv_{$item.id} option[value='{$item.pos_otv}']").prop('selected', true);</script>
	</td>
      <td style="text-align: center;">{$item.fio}</td>
	<td style=" text-align: center;">
		<input
			{if not $routes_enabled}disabled{/if}
			type=checkbox
			onClick="$('#copy2next_month_{$item.id}').val(this.checked?1:0);"
			{if $item.copy2next_month}checked{/if}
		>
		<input
			{if not $routes_enabled}disabled{/if}
			type=hidden
			id="copy2next_month_{$item.id}"
			name="copy2next_month[{$item.id}]"
			value="{$item.copy2next_month}"
		>
	</td>
	<td>
		с даты <input class=datepicker name="divide_from[{$item.id}]" size=9 value="{$smarty.request.month_list}"

			onChange="
				$('#cfrom_{$item.id}').val('true');
				$('#cfrom_{$item.id}').val()=='true'&&$('#cfio_{$item.id}').val()=='true'?$('#divide_go_{$item.id}').attr('disabled',false):null;
				$('#cfrom_{$item.id}').val()=='true'&&$('#cfio_{$item.id}').val()=='true'?$('#sm{$item.id}').show():null;
			"

>
		ф.и.о. отв. <input name="divide_fio_otv[{$item.id}]" size=15

			onChange="
				$('#cfio_{$item.id}').val('true');
				$('#cfrom_{$item.id}').val()=='true'&&$('#cfio_{$item.id}').val()=='true'?$('#divide_go_{$item.id}').attr('disabled',false):null;
				$('#cfrom_{$item.id}').val()=='true'&&$('#cfio_{$item.id}').val()=='true'?$('#sm{$item.id}').show():null;
			"

>
		<!--<input type=submit id="divide_go_{$item.id}" name="divide_go[{$item.id}]" value="Разделить">-->
		<input type=hidden id="divide_go_{$item.id}" name="divide_go[{$item.id}]" disabled>
		<input type=hidden id="cfrom_{$item.id}" value='false'>
		<input type=hidden id="cfio_{$item.id}" value='false'>
		<!--<a href="javascript:void(0);" >Разделить</a>-->
		<input id=sm{$item.id} type=submit value="Разделить">
		<script>$('#sm{$item.id}').hide();</script>
	</td>
    </tr>
	{/foreach}
</tbody>
</table>
<br>
<table style="text-align: left; width: 534px; height: 34px;" border="0" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td style=" text-align: center;"><input {if not $routes_enabled}disabled{/if} name="add_route" value="Добавить маршрут" type="submit"></td>
      <td style=" text-align: center;"><input {if not $routes_enabled}disabled{/if} name="save" value="Сохранить изменения" type="submit"><br>
      </td>
    </tr>
  </tbody>
</table>
<br>
<hr style="width: 100%; height: 2px;">


{/if}

<span style="font-weight: bold;"><br>
Закрепить ТП за маршрутом: 
</span>

<select name="select_route_numb" id="select_route_numb">
	<option></option>
	{foreach key=key item=item from=$routes_head}
		<option value="{$item.id}">маршрут: {$item.num} - ФИО отв. сотр.: {$item.fio_otv}</option>
	{/foreach}
</select>
<script>$('#select_route_numb option[value="{$smarty.request.select_route_numb}"]').prop('selected', true);</script>
<input value="Выбрать" name="select" type="submit">
 


{if ($is_mservice or $is_admin) and $smarty.request.select_route_numb and $routes_enabled}
<br><span style="font-weight: bold;"><input name="save" value="Сохранить маршрут" type="submit"></span><br>



<table style="text-align: left;" border="1" cellpadding="2" cellspacing="0">
    <tr style="text-align: center;font-weight:bold">
      <td>№ п/п</td>
      <td>Область<br>      </td>
      <td>Сеть</td>
      <td>Юридическое название ТЗ<br></td>
      <td>Адрес ТЗ<br></td>
      <td>Закрепить<br></td>
    </tr>

{foreach key=k item=i from=$d name=d}

	{math assign="color" equation='y' y=$smarty.foreach.d.iteration%10} 
	{if $color eq 1}
	{/if}
	<tr {if $i.tp_enabled eq 1}style="background-color:lightgreen"{/if}>
		<td>{$smarty.foreach.d.iteration}</td>
		<td>{$i.tz_oblast}</td>
		<td>{$i.net_name}</td>
		<td>{$i.ur_tz_name}</td>
		<td>{$i.tz_address}</td>
		<td style="text-align: center;">
			<input
				{if not $routes_enabled}disabled{/if}
				onclick="$('#rbtp_enabled{$i.kodtp}').val(this.checked?1:0)"
				{if $i.tp_enabled eq 1}checked{/if}
				{if not ($is_mservice or $is_admin)}disabled{/if}
				type="checkbox"
			>
			<input
				{if not $routes_enabled}disabled{/if}
				type=hidden
				name="rb[tp_enabled][{$i.kodtp}]"
				id="rbtp_enabled{$i.kodtp}"
				value="{$i.tp_enabled}">
		</td>
	</tr>
{/foreach}
    <tr style="text-align: center;font-weight:bold">
      <td colspan="5" rowspan="1" style="">ИТОГО</td>
      <td>{$rb_total}</td>
    </tr>

</table><br>

<br><span style="font-weight: bold;"><input name="save" value="Сохранить маршрут" type="submit"></span><br>
{/if}

</form>
