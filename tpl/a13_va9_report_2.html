<h2>Ход акции</h2>

{if not $smarty.request.print}

<p>
{if not $smarty.request.print and not $is_eta eq 1}
<input type=submit name=save id=save class=save value="Сохранить">
{/if}
</p>

{if $is_traid}
{literal}
<a href="javascript:void(0);" onclick="$('.chk_all:enabled').each(function(){$(this).prop('checked',false);$(this).click();});">[+]</a>
<a href="javascript:void(0);" onclick="$('.chk_all:enabled').each(function(){$(this).prop('checked',true);$(this).click();});">[-]</a>
{/literal}
{/if}

{/if}

<table border=1 cellspacing=0 cellpadding=3>
	<tr style="font-weight:bold; text-align:center">
		<td>№ п/п</td>
		<td>ФИО руководителя</td>
		<td>ФИО ТС</td>
		<td>ФИО ЭТА</td>
		<td>Название ТП</td>
		<td>Адрес ТП</td>
		<td>Продажи<br>август 2013,<br>{$valuta}</td>
		<td>Продажи<br>сентябрь 2013,<br>{$valuta}</td>
		<td>Прирост,<br>%</td>
		<td>Прирост,<br>{$valuta}</td>
		<td>Бонус<br>расчетный<br>(10%<br>от прироста<br>продаж),<br>{$valuta}</td>
		<!--<td>Запрет<br>ВСТМ</td>-->
		<td>Бонус<br>выдан</td>
		<td>Сумма<br>бонуса<br>фактич.,<br>{$valuta}</td>
		<td>Подтверждение<br>рук-ля</td>
	</tr>
	{foreach key=list_key item=list_item from=$list name=list}
	<tr bgcolor="{cycle values="#ccffff,#ffffcc"}"
		{if $list_item.fakt_bonus > $list_item.bonus_plan}style="background-color: red"{/if}
		{if $list_item.is_act eq 1}style="background-color: rgb(51, 255, 51)"{/if}
	>
		<td>{$smarty.foreach.list.iteration}</td>
		<td>{$list_item.parent_fio}</td>
		<td>{$list_item.fio_ts}</td>
		<td>{$list_item.fio_eta}</td>
		<td>{$list_item.tp_kod} {$list_item.tp_ur}</td>
		<td>{$list_item.tp_addr}</td>
		<td style="text-align:right">{$list_item.sum08|default:0|num:2}</td>
		<td style="text-align:right">{$list_item.sum09|default:0|num:2}</td>
		<td style="text-align:right">{$list_item.rost_perc|default:0|num:2}</td>
		<td style="text-align:right">{$list_item.rost_uah|default:0|num:2}</td>
		<td style="text-align:right">{$list_item.bonus_plan|default:0|num:2}</td>
		<!--<td style="text-align:center">
			{if not $smarty.request.print}
			<input
			name="cb_traid[]"
			type=checkbox
			onclick="javascript:check_item('ok2',{$list_item.tp_kod},'ok_traid',this.checked)"
			{if $list_item.ok_traid eq 1}checked{/if}
			{if not $is_traid or $list_item.ok_ts eq 1 or $list_item.ok_chief eq 1}disabled{/if}
			>
			{if $list_item.ok_traid eq 1}да{/if}{if $list_item.ok_traid eq '0'}нет{/if}
			{else}
				{if $list_item.ok_traid eq 1}да{/if}
			{/if}
		</td>-->
		<td {if $list_item.ok_ts eq 1}bgcolor="#00ff00"{/if}>
			{if not $smarty.request.print}
			<input type="checkbox"
			onclick="javascript:check_item('ok2',{$list_item.tp_kod},'ok_ts',this.checked,'ok_ts_date','fakt_bonus')"
			{if $list_item.ok_ts eq 1}checked{/if}
			{if $list_item.is_act neq 1 or not $list_item.ok_traid neq 1 or not $is_ts or $list_item.tn neq $tn or $list_item.ok_chief eq 1}disabled{/if}
			>
			Дата
			<input class="datepicker" name=ok_ts_date[{$list_item.tp_kod}] size=11
			{if not $list_item.ok_ts or not $list_item.ok_traid neq 1 or not $is_ts or $list_item.tn neq $tn or $list_item.ok_chief eq 1}disabled{/if}
			required value="{$list_item.ok_ts_date}"
			>
			{else}
				{if $list_item.ok_ts eq 1}да{/if} {$list_item.ok_ts_date}
			{/if}
		</td>
		<td {if $list_item.ok_ts eq 1}bgcolor="#00ff00"{/if}>
			{if not $smarty.request.print}
			<input class="number" name=fakt_bonus[{$list_item.tp_kod}] size=11 id=fakt_bonus_{$list_item.tp_kod}
			{if not $list_item.ok_ts or not $list_item.ok_traid neq 1 or not $is_ts or $list_item.tn neq $tn or $list_item.ok_chief eq 1}disabled{/if}
			required value="{$list_item.fakt_bonus}"
			onchange="z({$list_item.tp_kod},{$list_item.bonus_plan});"
			>
			{else}
			{$list_item.fakt_bonus}
			{/if}
		</td>
		<td>
			{if not $smarty.request.print}
			<input type="checkbox"
			onclick="javascript:check_item('ok2',{$list_item.tp_kod},'ok_chief',this.checked)"
			{if $list_item.ok_chief eq 1}checked{/if}
			{if not $list_item.ok_traid neq 1 or $list_item.ok_ts neq 1 or $list_item.parent_tn neq $tn}disabled{/if}
			>
			{if $list_item.ok_chief eq 1}{$list_item.parent_fio} {$list_item.ok_chief_date}{/if}
			{else}
				{if $list_item.ok_chief eq 1}да {$list_item.parent_fio} {$list_item.ok_chief_date}{/if}
			{/if}
		</td>
		{if not $smarty.request.print}
			<!--<input type=hidden name=ok2[ok_traid][{$list_item.tp_kod}]>-->
			<input type=hidden name=ok2[ok_ts][{$list_item.tp_kod}]>
			<input type=hidden name=ok2[ok_chief][{$list_item.tp_kod}]>
			<input type=hidden class=checker id=checker_{$list_item.tp_kod} value=0>
		{/if}
	</tr>
	{/foreach}
</table>


{if not $smarty.request.print}


{literal}
<script>
function z(id,summa)
{
	if ($('#fakt_bonus_'+id).val()>summa)
	{
		alert('Накладная не может быть добавлена, так как превышена затратная часть!');
		$('#checker_'+id).attr('disabled',true);
	}
	else
	{
		$('#checker_'+id).attr('disabled',false);
	}
	$('.checker:disabled').length!=0 ? $('.save').attr('disabled',true) : $('.save').attr('disabled',false);

}
</script>
{/literal}

{/if}


<p>
{if not $smarty.request.print and not $is_eta eq 1}
<input type=submit name=save id=save class=save value="Сохранить">
{/if}
</p>




