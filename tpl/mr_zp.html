<form target="_self" method="POST" name=form1 id=form1>
<h1>З/п за месяц</h1>





<table>

	<tr>
		<td style="text-align:right">Выберите месяц</td>
		<td style="text-align:left">
			<select name=month_list id=month_list onchange="$('#form1').submit();">
				{foreach key=key item=item from=$month_list}
				<option value="{$item.sd_c}">{$item.my}</option>
				{/foreach}
			</select>
			<script>$("#month_list option[value='{$smarty.request.month_list}']").prop('selected', true);</script>
		</td>
	</tr>
	<tr>
		<td style="text-align:right">СВ МС</td>
		<td style="text-align:left">
			<select name=svms_list id=svms_list>
				<option value=0></option>
				{foreach key=key item=item from=$svms_list}
				<option value="{$item.tn}">{$item.fio} ({$item.tn})</option>
				{/foreach}
			</select>
			<script>$('#svms_list option[value="{$smarty.request.svms_list}"]').prop('selected', true);</script>
		</td>
	</tr>
	<tr>
		<td style="text-align:right">Маршрут</td>
		<td style="text-align:left">
			<select name="select_route_numb" id="select_route_numb">
				<option value=0></option>
				{foreach key=key item=item from=$routes_head}
				<option value="{$item.id}">{$item.fio} - {$item.num} - {$item.fio_otv}</option>
				{/foreach}
			</select>
			<script>$('#select_route_numb option[value={$smarty.request.select_route_numb}]').prop('selected', true);</script>
		</td>
	</tr>
	<tr>
		<td style="text-align:right">Фильтр по сумме</td>
		<td>
			<input checked="checked" name="flt_sum" id="flt_sum" value="0" type="radio"> все
			<input name="flt_sum" id="flt_sum" value="1" type="radio"> Сумма 1 не выплачена
			<input name="flt_sum" id="flt_sum" value="2" type="radio"> Сумма 2 не выплачена
			<script>$("input[name=flt_sum][value={$smarty.request.flt_sum}]").attr('checked',true);</script>
		</td>
	</tr>
	<tr>
		<td style="text-align:right">Фильтр по PIN</td>
		<td>
			<input checked="checked" name="flt_pin" id="flt_pin" value="0" type="radio"> все
			<input name="flt_pin" id="flt_pin" value="1" type="radio"> PIN1 не совпал
			<input name="flt_pin" id="flt_pin" value="2" type="radio"> PIN2 не совпал
			<script>$("input[name=flt_pin][value={$smarty.request.flt_pin}]").attr('checked',true);</script>
		</td>
	</tr>
</table>

<input value="Выбрать" name="select_month" type="submit">
</form>

<div id=hpart1>
часть 1
<input
	type=checkbox
	id=hpart1val
	value="{$h.part1}"
	onChange="savem('{$smarty.request.month_list}','part1',this.checked?1:0);"
>
{$h.part1_lu}
{$h.part1_lu_fio}
</div>
<div id=hpart2>
часть 2
<input
	type=checkbox
	id=hpart2val
	value="{$h.part2}"
	onChange="savem('{$smarty.request.month_list}','part2',this.checked?1:0);"
>
{$h.part2_lu}
{$h.part2_lu_fio}
</div>
<script>
$("#hpart1val").prop('checked','{$h.part1}'=='1'?true:false);
$("#hpart2val").prop('checked','{$h.part2}'=='1'?true:false);
</script>

<table border=1 cellspacing=0 cellpadding=3>
	<tr style="font-weight:bold">
		<td>№ п/п</td>
		<td>ФИО СВ МС</td>
		<td>Название маршрута</td>
		<td>ФИО ответственного</td>
		<td>PIN</td>
		<td>Последнее изменение</td>
		<td style="background-color: rgb(204, 255, 255);">Сумма периода 1</td>
		<td style="background-color: rgb(204, 255, 255);">PIN совпал</td>
		<td style="background-color: rgb(204, 255, 255);">STAMP</td>
		<td style="background-color: rgb(255, 255, 204);">Сумма периода 2</td>
		<td style="background-color: rgb(255, 255, 204);">PIN совпал</td>
		<td style="background-color: rgb(255, 255, 204);">STAMP</td>
	</tr>
	{foreach key=k item=i from=$zp name=zp}
		<tr bgcolor="{cycle values="#ccffff,#ffffcc"}">
			<td>{$smarty.foreach.zp.iteration}</td>
			<td>{$i.svms}</td>
			<td>{$i.num}</td>
			<td>{$i.fio_otv}</td>
			<td>
				<input
					class="num4"
					name=data[{$i.id}]
					id=data{$i.id}pin
					value="{$i.pin}"
					onChange="save({$i.id},'pin',this.value);"
					size=5
				>
			</td>
			<td>{$i.pin_lu} {$i.pin_lu_fio}</td>
			<td style="background-color: rgb(204, 255, 255); text-align:right">{$i.part1_sum|num:2}</td>
			<td style="background-color: {if $i.part1_pin_ok}rgb(204, 255, 255);{else}red{/if}">{if $i.part1_pin_ok}да{else}нет{/if}</td>
			<td style="background-color: rgb(204, 255, 255);">{$i.part1_lu}</td>
			<td style="background-color: rgb(255, 255, 204); text-align:right">{$i.part2_sum|num:2}</td>
			<td style="background-color: {if $i.part2_pin_ok}rgb(255, 255, 204);{else}red{/if}">{if $i.part2_pin_ok}да{else}нет{/if}</td>
			<td style="background-color: rgb(255, 255, 204);">{$i.part2_lu}</td>
		</tr>
	{/foreach}
		<tr style="font-weight:bold;text-align:right">
			<td style="text-align:center" colspan=6>ИТОГО:{$zpt.cnt}</td>
			<td>{$zpt.part1_sum|num:2}</td>
			<td>{$zpt.part1_pin_ok}</td>
			<td></td>
			<td>{$zpt.part2_sum|num:2}</td>
			<td>{$zpt.part2_pin_ok}</td>
			<td></td>
		</tr>
</table>



{literal}
<script>
$('.num4').mask('9999');
function save(id,field,val)
{
	$('#data'+id+field).css('background-color','red');
	$('#ok').load('?action=mr_zp&save=1&nohead=1',
	{
		id: id,
		field: field,
		val: val
	},
	function() {
	$('#data'+id+field).css('background-color','white');
	});
}
function savem(dt,field,val)
{
	$('#h'+field).css('background-color','red');
	$('#ok').load('?action=mr_zp&savem=1&nohead=1',
	{
		dt: dt,
		field: field,
		val: val
	},
	function() {
	$('#h'+field).css('background-color','white');
	});
}
</script>
{/literal}

<div id="ok" style="display: inline;"></div>
