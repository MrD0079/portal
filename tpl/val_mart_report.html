<h1>
{if $smarty.request.giveup eq 1}
Выдача подарков
{elseif $smarty.request.giveup_check eq 1}
Контроль выдачи подарков
{else}
Общий отчет
{/if}
 по акции "ВАЛ Март"
</h1>


{if not $smarty.request.print}

<form target="_self" method="POST" name=form_report id=form_report>


{if $is_ts neq 1}


По руководителю:
<br>
<select name=exp_list_without_ts id=exp_list_without_ts onchange="javascript:fn_submit('exp_list_without_ts');">
<option value=0></option>
{foreach key=key item=item from=$exp_list_without_ts}
<option value={$item.emp_svid}><b>{$item.emp_name}</b> ({$item.emp_pos}) {if $item.datauvol}уволен {$item.datauvol}{/if}</option>
{/foreach}
</select>


<br>

По супервайзеру:
<br>
<select name=exp_list_only_ts id=exp_list_only_ts onchange="javascript:fn_submit('exp_list_only_ts');">
<option value=0></option>
{foreach key=key item=item from=$exp_list_only_ts}
<option value={$item.emp_svid}><b>{$item.emp_name}</b> ({$item.emp_pos}) {if $item.datauvol}уволен {$item.datauvol}{/if}</option>
{/foreach}
</select>

<br>

<script>$("#exp_list_without_ts option[value={$smarty.request.exp_list_without_ts}]").prop('selected', true);</script>
<script>$("#exp_list_only_ts option[value={$smarty.request.exp_list_only_ts}]").prop('selected', true);</script>



<input type="hidden" name="form_submit" id=form_submit>

{literal}
<script>
function fn_submit(val)
{
	$('#form_submit').val(val);
	$('#form_report').submit();
}
</script>
{/literal}


{/if}

{if $smarty.request.giveup}
	Подарок выдан ТС:
	<br>
	<input type=radio id="ok_ts" name="ok_ts" value=1>все
	<input type=radio id="ok_ts" name="ok_ts" value=2>выдан ТС
	<input type=radio id="ok_ts" name="ok_ts" value=3>не выдан ТС
	<br>
<script>$("input[name=ok_ts][value={$smarty.request.ok_ts|default:1}]").attr('checked',true);</script>
<br>
	Выдача бонуса подтверждена руководителем:
	<br>
	<input type=radio id="ok_chief" name="ok_chief" value=1>все
	<input type=radio id="ok_chief" name="ok_chief" value=2>подтверждено руководителем
	<input type=radio id="ok_chief" name="ok_chief" value=3>не подтверждено руководителем
	<br>
<script>$("input[name=ok_chief][value={$smarty.request.ok_chief|default:1}]").attr('checked',true);</script>

{else}
	Подтверждение ВСТМ:
	<br>
	<input type=radio id="ok_traid" name="ok_traid" value=1>все
	<input type=radio id="ok_traid" name="ok_traid" value=2>подтверждено ВСТМ
	<input type=radio id="ok_traid" name="ok_traid" value=3>не подтверждено ВСТМ
	<br>
<script>$("input[name=ok_traid][value={$smarty.request.ok_traid|default:1}]").attr('checked',true);</script>
{/if}



<input type=submit name=generate id=generate value="Выбрать">
<br>


<a href="?action=val_mart_report{if $smarty.request.giveup eq 1}&giveup=1{/if}{if $smarty.request.giveup_check eq 1}&giveup_check=1{/if}&print=1&excel=1&filename={if $smarty.request.giveup eq 1}Выдача подарков{elseif $smarty.request.giveup_check eq 1}Контроль выдачи подарков{else}Общий отчет{/if} по акции ВАЛ Март">Экспорт в Excel</a>

{/if}


{include file="val_mart_report_a.html"}
{include file="val_mart_report_b.html"}


{if not $smarty.request.print}

</form>

{literal}
<script type="text/javascript">

function check_item($ok,$k1,$k2,$e,$sck,$date,$fakt)
{
	var hd = document.forms["form_report"].elements[""+$ok+"["+$e+"]["+$k1+"]["+$k2+"]"];
	if ($date)
	{
		var sum_fakt = document.forms["form_report"].elements[$fakt+"["+$k1+"]["+$k2+"]"];
		var date = document.forms["form_report"].elements["date["+$date+"]["+$k1+"]["+$k2+"]"];
		var tn = document.forms["form_report"].elements["ok_tn["+$e+"_tn]["+$k1+"]["+$k2+"]"];
	}
	if ($sck)
	{
		hd.value=1;
		if ($date)
		{
			date.disabled=false;
		}
		if ($fakt)
		{
			sum_fakt.disabled=false;
		}
		if (tn) tn.value={/literal}{$tn}{literal};
	}
	else
	{
		hd.value=0;
		if ($date)
		{
			date.value="";
			date.disabled=true;
			if (tn) tn.value="";
		}
		if ($fakt)
		{
			sum_fakt.disabled=true;
		}
	}
}
</script>
{/literal}

{/if}