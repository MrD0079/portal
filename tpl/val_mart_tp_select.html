<h1>Выбор ТП для участия в акции "ВАЛ Март"</h1>
<form target="_self" method="POST" name=form_tp id=form_tp>
	<input type=submit name=save id=save class=save value="Сохранить">
	<br>
	<br>
	<table border=1 cellspacing=0 cellpadding=3>
		<tr style="font-weight:bold; text-align:center">
			<td>№ п/п</td>
			<td>ТС</td>
			<td>ФИО ЭТА</td>
			<td>Код ТП</td>
			<td>Название ТП</td>
			<td>Адрес ТП</td>
			<td>Продажи<br>февраль<br>2012,<br>{$valuta}.</td>
			<td>Участвует<br>в акции</td>
			<td>Категория ТП</td>
			<td>Контактный<br>номер ЛПР, имя</td>
		</tr>
		{foreach key=tp_key item=tp_item from=$tp name=tp}
		<tr {if $tp_item.enabled eq 1}style="font-weight:bold;color:red"{/if}>
			<td>{$smarty.foreach.tp.iteration}</td>
			<td>{$tp_item.fio_ts}</td>
			<td>{$tp_item.fio_eta}</td>
			<td>{$tp_item.tp_kod}</td>
			<td>{$tp_item.tp_ur}</td>
			<td>{$tp_item.tp_addr}</td>
			<td style="text-align:right">{$tp_item.sales|default:0|num:3}</td>
			<td {if $tp_item.selected eq 1}bgcolor="#00ff00"{/if} style="text-align:center">
				<input
					onclick="javascript:check_item1({$tp_item.tp_kod},'selected','contact_lpr','tp_kat',true)"
					type=checkbox
					{if $tp_item.selected eq 1}checked{/if}
					name=selected_on[{$tp_item.tp_kod}]
					value="{$tp_item.tp_kod}"
				>
				<input type=hidden name=selected_changed[{$tp_item.tp_kod}] value="">
			</td>
			<td>
				<select
					{if $tp_item.selected neq 1} disabled {/if}
					required="required"
					name=tp_kat[{$tp_item.tp_kod}]
					id=tp_kat[{$tp_item.tp_kod}]
					value="{$tp_item.tp_kat}"
				>
					{foreach key=k item=i from=$val_mart_kat}
						<option {if $tp_item.sales < 1000 and $i.id eq 1}disabled{/if} value={$i.id}>{$i.kat_name}</option>
					{/foreach}
				</select>
				{if $tp_item.selected eq 1}
				<script>$("#tp_kat[{$tp_item.tp_kod}] option[value='{$tp_item.tp_kat}']").prop('selected', true);</script>
				{else}
				<script>$("#tp_kat[{$tp_item.tp_kod}] option[value='2']").prop('selected', true);</script>
				{/if}
			</td>
			<td><input {if $tp_item.selected neq 1} disabled {/if} type=text required="required" size=25 name=contact_lpr[{$tp_item.tp_kod}] id=contact_lpr[{$tp_item.tp_kod}] value="{$tp_item.contact_lpr|escape}"></td>
		</tr>
		{/foreach}
		<tr style="font-weight:bold; text-align:center">
			<td colspan=7>Итого</td>
			{foreach key=tp_key item=tp_item from=$tp_total}
			<td style="text-align:right">{$tp_item.selected|default:0}</td>
			<td colspan=2></td>
			{/foreach}
		</tr>
	</table>
	<br>
	<input type=submit name=save id=save class=save value="Сохранить">
	<br>
	<br>
</form>

{literal}
<script>
function check_item1($v,$v2,$v3,$v4,required)
{
	var e = document.forms["form_tp"].elements[$v3+"["+$v+"]"];
	var e1 = document.forms["form_tp"].elements[$v4+"["+$v+"]"];
	var cbs = document.forms["form_tp"].elements[$v2+"_on["+$v+"]"];
	var cbs2 = document.forms["form_tp"].elements[$v2+"_changed["+$v+"]"];
	if (cbs.checked)
	{
		cbs2.value='on';
		e.disabled=false;
		e1.disabled=false;
		e1["required"]="required";
		e["required"]="required";
	}
	else
	{
		cbs2.value=$v;
		e.disabled=true;
		e1.disabled=true;
	}
}
</script>
{/literal}
